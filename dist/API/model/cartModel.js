"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(a,o){try{var s=t[a](o),c=s.value}catch(e){return void r(e)}return s.done?void e(c):Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_general=require("../db/interaction/general.js"),Queries=_interopRequireWildcard(_general),pool=require("../db/connect.js"),secret=require("../general/jwtSecret.js"),jwt=require("jsonwebtoken"),CartModel=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";_classCallCheck(this,e),this.sql=a,this.data=t,this.next=r,this.token=n}return _createClass(e,[{key:"checkCartExist",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=jwt.verify(this.token,secret),e.next=4,pool.getConnection();case 4:return r=e.sent,e.next=7,r.query(this.sql,[t.user_id]);case 7:return n=e.sent,r.connection.release(),console.log("cart",n),e.abrupt("return",n);case 13:e.prev=13,e.t0=e.catch(0),console.log(e.t0);case 16:case"end":return e.stop()}},e,this,[[0,13]])}));return e}()},{key:"createCart",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Queries.standardInsertQuery(this.sql,[],this.next,this.token);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}},e,this)}));return e}()},{key:"getCart",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=jwt.verify(this.token,secret),e.next=4,pool.getConnection();case 4:return r=e.sent,e.next=7,r.query(this.sql,[t.user_id]);case 7:return n=e.sent,r.connection.release(),e.abrupt("return",n);case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0);case 15:case"end":return e.stop()}},e,this,[[0,12]])}));return e}()},{key:"checkCartProduct",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=jwt.verify(this.token,secret),e.next=4,pool.getConnection();case 4:return r=e.sent,e.next=7,r.query(this.sql,[this.data.cart_id,this.data.product_id]);case 7:return n=e.sent,r.connection.release(),e.abrupt("return",n);case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0),this.next(e.t0);case 16:case"end":return e.stop()}},e,this,[[0,12]])}));return e}()},{key:"updateCartProduct",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=jwt.verify(this.token,secret),e.next=4,pool.getConnection();case 4:return r=e.sent,console.log("SQL",this.sql),e.next=8,r.query(this.sql,[this.data.quantity,this.data.cart_id,this.data.product_id]);case 8:return n=e.sent,r.connection.release(),e.abrupt("return",n);case 13:e.prev=13,e.t0=e.catch(0),console.log(e.t0),this.next(e.t0);case 17:case"end":return e.stop()}},e,this,[[0,13]])}));return e}()},{key:"addToCart",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=jwt.verify(this.token,secret),e.next=4,pool.getConnection();case 4:return r=e.sent,e.next=7,r.query(this.sql,this.data);case 7:return n=e.sent,r.connection.release(),e.abrupt("return",n);case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0),this.next(e.t0);case 16:case"end":return e.stop()}},e,this,[[0,12]])}));return e}()},{key:"deleteFromCart",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=jwt.verify(this.token,secret),e.next=4,pool.getConnection();case 4:return r=e.sent,e.next=7,r.query(this.sql,[this.data.cart_id,this.data.product_id]);case 7:return n=e.sent,r.connection.release(),e.abrupt("return",n);case 12:e.prev=12,e.t0=e.catch(0),console.log(e.t0),this.next(e.t0);case 16:case"end":return e.stop()}},e,this,[[0,12]])}));return e}()}]),e}();exports.default=CartModel;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZGVsL2NhcnRNb2RlbC5qcyJdLCJuYW1lcyI6WyJfZ2VuZXJhbCIsInJlcXVpcmUiLCJRdWVyaWVzIiwicG9vbCIsInNlY3JldCIsImp3dCIsIkNhcnRNb2RlbCIsImRhdGEiLCJuZXh0IiwidG9rZW4iLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJzcWwiLCJfY2xhc3NDYWxsQ2hlY2siLCJ0aGlzIiwiZGVjb2RlZCIsInZlcmlmeSIsImdldENvbm5lY3Rpb24iLCJjb25uZWN0aW9uIiwicXVlcnkiLCJ1c2VyX2lkIiwicmVzdWx0IiwicmVsZWFzZSIsImNvbnNvbGUiLCJsb2ciLCJfY29udGV4dCIsInQwIiwic3RhbmRhcmRJbnNlcnRRdWVyeSIsIl9jb250ZXh0MyIsImNhcnRfaWQiLCJwcm9kdWN0X2lkIiwiX2NvbnRleHQ0IiwicXVhbnRpdHkiLCJfY29udGV4dDUiLCJfY29udGV4dDYiLCJfY29udGV4dDciXSwibWFwcGluZ3MiOiJnNUJBQ0FBLFNBQUFDLFFBQUEsZ0NBQVlDLDBDQURSQyxLQUFPRixRQUFRLG9CQUVmRyxPQUFTSCxRQUFRLDJCQUNqQkksSUFBTUosUUFBUSxnQkFFR0sscUJBQ25CLFFBQUFBLEdBQVlDLEVBQU1DLEdBQTRCLEdBQXRCQyxHQUFzQkMsVUFBQUMsT0FBQSxHQUFBQyxTQUFBRixVQUFBLEdBQUFBLFVBQUEsR0FBZCxHQUFJRyxFQUFVSCxVQUFBQyxPQUFBLEdBQUFDLFNBQUFGLFVBQUEsR0FBQUEsVUFBQSxHQUFKLEVBQUlJLGlCQUFBQyxLQUFBVCxHQUM1Q1MsS0FBS0YsSUFBTUEsRUFOZkUsS0FBQVIsS0FBQUEsRUFRSVEsS0FBS1AsS0FBT0EsRUFSSk4sS0FBQUEsTUFTS08sa1JBS1BPLEVBQVVYLElBQUlZLE9BQU9GLEtBQUtOLE1BQU9MLGlCQUNaRCxLQUFLZSw2QkFBeEJDLG1CQUNlQSxFQUFXQyxNQUFNTCxLQUFLRixLQUFNRyxFQUFRSyx1QkFBbkRDLFVBakJSbkIsRUFBT0YsV0FBUXNCLFVBbUJiQyxRQUFRQyxJQUFJLE9BQVFILHFCQWpCYnJCLHFDQW9CUHVCLFFBQVFDLElBQVJDLEVBQUFDLDBUQUttQnpCLFFBQVEwQixvQkFBb0JiLEtBQUtGLE9BQVNFLEtBQUtQLEtBQU1PLEtBQUtOLG9CQUF6RWEsNEJBckJzQ0EsZ1RBSXZDYixFQUFRQSxJQUFiUSxPQUFBRixLQUFBTixNQUFBTCxpQkFDREQsS0FBQWUsNkJBQUFDLG1CQXdCd0JBLEVBQVdDLE1BQU1MLEtBQUtGLEtBQU1HLEVBQVFLLHVCQUFuREMsVUFDTkgsRUFBV0EsV0FBV0ksNEJBQ2ZELHFDQUVQRSxRQUFRQyxJQUFSSSxFQUFBRixvVUFNSVgsRUFBVVgsSUFBSVksT0FBT0YsS0FBS04sTUFBT0wsaUJBOUJuQmEsS0FBSkMsNkJBQVZGLG1CQWdDaUJHLEVBQVdDLE1BQU1MLEtBQUtGLEtBQU1FLEtBQUtSLEtBQUt1QixRQUFTZixLQUFLUixLQUFLd0IsMEJBQXhFVCxVQUNOSCxFQUFXQSxXQWhDbUJELDRCQWlDdkJJLHFDQWpDREgsUUFBQUEsSUFBQUEsRUFBQUEsSUFvQ05KLEtBQUtQLEtBQUx3QixFQUFBTCxxVUFsQ0FSLEVBQUFBLElBQUFBLE9BQVdBLEtBQUFBLE1BQVdJLGlCQUNWcEIsS0FBUW1CLDZCQUFwQkUsVUF5Q0FBLFFBQVFDLElBQUksTUFBT1YsS0FBS0YsY0FDSE0sRUFBV0MsTUFBTUwsS0FBS0YsS0FBTUUsS0FBS1IsS0FBSzBCLFNBQVVsQixLQUFLUixLQUFLdUIsUUFBU2YsS0FBS1IsS0FBS3dCLDBCQUE1RlQsVUFDTkgsRUFBV0EsV0FBV0ksNEJBQ2ZELHFDQUVQRSxRQUFRQyxJQUFSUyxFQUFBUCxJQTNDQUgsS0FBQUEsS0FBQUEsRUFBQUEsNlRBa0RJUixFQUFVWCxJQUFJWSxPQUFPRixLQUFLTixNQUFPTCxpQkFDWkQsS0FBS2UsNkJBQXhCQyxtQkFDZUEsRUFBV0MsTUFBTUwsS0FBS0YsSUFBS0UsS0FBS1IsbUJBQS9DZSxVQUNOSCxFQUFXQSxXQUFXSSw0QkFDZkQscUNBRVBFLFFBQVFDLElBQVJVLEVBQUFSLElBQ0FaLEtBQUtQLEtBQUwyQixFQUFBUixrVUFNSVgsRUFBVVgsSUFBSVksT0FBT0YsS0FBS04sTUFBT0wsaUJBQ1pELEtBQUtlLDZCQUF4QkMsbUJBQ2VBLEVBQVdDLE1BQU1MLEtBQUtGLEtBQU1FLEtBQUtSLEtBQUt1QixRQUFTZixLQUFLUixLQUFLd0IsMEJBQXhFVCxVQUNOSCxFQUFXQSxXQUFXSSw0QkFDZkQscUNBRVBFLFFBQVFDLElBQVJXLEVBQUFULElBQ0FaLEtBQUtQLEtBQUw0QixFQUFBVCxnR0F2RmVyQiIsImZpbGUiOiJtb2RlbC9jYXJ0TW9kZWwuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgcG9vbCA9IHJlcXVpcmUoJy4uL2RiL2Nvbm5lY3QuanMnKTtcbmltcG9ydCAqIGFzIFF1ZXJpZXMgZnJvbSAnLi4vZGIvaW50ZXJhY3Rpb24vZ2VuZXJhbC5qcyc7XG52YXIgc2VjcmV0ID0gcmVxdWlyZSgnLi4vZ2VuZXJhbC9qd3RTZWNyZXQuanMnKTtcbnZhciBqd3QgPSByZXF1aXJlKCdqc29ud2VidG9rZW4nKTtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FydE1vZGVsIHtcbiAgY29uc3RydWN0b3IoZGF0YSwgbmV4dCwgdG9rZW4gPSAnJywgc3FsID0gJycpIHtcbiAgICB0aGlzLnNxbCA9IHNxbDtcbiAgICB0aGlzLmRhdGEgPSBkYXRhO1xuICAgIHRoaXMubmV4dCA9IG5leHQ7XG4gICAgdGhpcy50b2tlbiA9IHRva2VuO1xuICB9O1xuXG4gIGFzeW5jIGNoZWNrQ2FydEV4aXN0KCkge1xuICAgIHRyeSB7XG4gICAgICB2YXIgZGVjb2RlZCA9IGp3dC52ZXJpZnkodGhpcy50b2tlbiwgc2VjcmV0KTtcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBhd2FpdCBwb29sLmdldENvbm5lY3Rpb24oKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbm5lY3Rpb24ucXVlcnkodGhpcy5zcWwsIFtkZWNvZGVkLnVzZXJfaWRdKTtcbiAgICAgIGNvbm5lY3Rpb24uY29ubmVjdGlvbi5yZWxlYXNlKCk7XG4gICAgICBjb25zb2xlLmxvZyhcImNhcnRcIiwgcmVzdWx0KTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaChlKSB7XG4gICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBjcmVhdGVDYXJ0KCkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFF1ZXJpZXMuc3RhbmRhcmRJbnNlcnRRdWVyeSh0aGlzLnNxbCwgW10sIHRoaXMubmV4dCwgdGhpcy50b2tlbik7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGFzeW5jIGdldENhcnQoKSB7XG4gICAgdHJ5IHtcbiAgICAgIHZhciBkZWNvZGVkID0gand0LnZlcmlmeSh0aGlzLnRva2VuLCBzZWNyZXQpO1xuICAgICAgY29uc3QgY29ubmVjdGlvbiA9IGF3YWl0IHBvb2wuZ2V0Q29ubmVjdGlvbigpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29ubmVjdGlvbi5xdWVyeSh0aGlzLnNxbCwgW2RlY29kZWQudXNlcl9pZF0pO1xuICAgICAgY29ubmVjdGlvbi5jb25uZWN0aW9uLnJlbGVhc2UoKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaChlKSB7XG4gICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBjaGVja0NhcnRQcm9kdWN0KCkge1xuICAgIHRyeSB7XG4gICAgICB2YXIgZGVjb2RlZCA9IGp3dC52ZXJpZnkodGhpcy50b2tlbiwgc2VjcmV0KTtcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBhd2FpdCBwb29sLmdldENvbm5lY3Rpb24oKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbm5lY3Rpb24ucXVlcnkodGhpcy5zcWwsIFt0aGlzLmRhdGEuY2FydF9pZCwgdGhpcy5kYXRhLnByb2R1Y3RfaWRdKTtcbiAgICAgIGNvbm5lY3Rpb24uY29ubmVjdGlvbi5yZWxlYXNlKCk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgdGhpcy5uZXh0KGUpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZUNhcnRQcm9kdWN0KCkge1xuICAgIHRyeSB7XG4gICAgICB2YXIgZGVjb2RlZCA9IGp3dC52ZXJpZnkodGhpcy50b2tlbiwgc2VjcmV0KTtcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBhd2FpdCBwb29sLmdldENvbm5lY3Rpb24oKTtcbiAgICAgIGNvbnNvbGUubG9nKFwiU1FMXCIsIHRoaXMuc3FsKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbm5lY3Rpb24ucXVlcnkodGhpcy5zcWwsIFt0aGlzLmRhdGEucXVhbnRpdHksIHRoaXMuZGF0YS5jYXJ0X2lkLCB0aGlzLmRhdGEucHJvZHVjdF9pZF0pO1xuICAgICAgY29ubmVjdGlvbi5jb25uZWN0aW9uLnJlbGVhc2UoKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgICB0aGlzLm5leHQoZSk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgYWRkVG9DYXJ0KCkge1xuICAgIHRyeSB7XG4gICAgICB2YXIgZGVjb2RlZCA9IGp3dC52ZXJpZnkodGhpcy50b2tlbiwgc2VjcmV0KTtcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBhd2FpdCBwb29sLmdldENvbm5lY3Rpb24oKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbm5lY3Rpb24ucXVlcnkodGhpcy5zcWwsIHRoaXMuZGF0YSk7XG4gICAgICBjb25uZWN0aW9uLmNvbm5lY3Rpb24ucmVsZWFzZSgpO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgIHRoaXMubmV4dChlKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBkZWxldGVGcm9tQ2FydCgpIHtcbiAgICB0cnkge1xuICAgICAgdmFyIGRlY29kZWQgPSBqd3QudmVyaWZ5KHRoaXMudG9rZW4sIHNlY3JldCk7XG4gICAgICBjb25zdCBjb25uZWN0aW9uID0gYXdhaXQgcG9vbC5nZXRDb25uZWN0aW9uKCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb25uZWN0aW9uLnF1ZXJ5KHRoaXMuc3FsLCBbdGhpcy5kYXRhLmNhcnRfaWQsIHRoaXMuZGF0YS5wcm9kdWN0X2lkXSk7XG4gICAgICBjb25uZWN0aW9uLmNvbm5lY3Rpb24ucmVsZWFzZSgpO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgIHRoaXMubmV4dChlKTtcbiAgICB9XG4gIH1cblxufVxuIl19

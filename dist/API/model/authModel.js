"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,o){for(var s=0;s<o.length;s++){var n=o[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(o,s,n){return s&&e(o.prototype,s),n&&e(o,n),o}}(),_email2=require("../email/email.js"),_email3=_interopRequireDefault(_email2),bcrypt=require("bcrypt"),pool=require("../../../db/connect.js"),saltRounds=10,AuthModel=function(){function e(o,s,n){_classCallCheck(this,e),this.sql=o,this.data=s,this.res=n}return _createClass(e,[{key:"confirmUser",value:function(){var e=this;pool.getConnection(function(o,s){s.query(e.sql,[e.data.token],function(o,n){o&&(console.log(o),s.release()),n.affectedRows>0?e.res.status(200).json({success:!0}):e.res.status(404).json({success:!1})})})}},{key:"register",value:function(){var e=this;pool.getConnection(function(o,s){s.query(e.sql,[e.data.email],function(o,n){o&&(console.log(o),s.release()),n.length>0?(s.release(),e.res.status(422).json({error:"exists"})):bcrypt.genSalt(saltRounds,function(o,n){bcrypt.hash(e.data.password,n,function(o,n){e.data.password=n;var t=e.data,a=t.email,r=t.password,l=t.first_name,i=t.last_name,c=t.phone,u={email:a,password:r,first_name:l,last_name:i,phone:c};console.log("user",u),a&&r&&l&&i&&c?pool.getConnection(function(o,s){o&&console.log(o),s.query("INSERT INTO _users SET ?",u,function(o,n){if(o)console.log(o),s.release();else{var t="www.testsite.com",a="You are receiving this because you (or someone else) have signed up to the website.\n\nPlease click on the following link, or paste this into your browser to complete the process:\n\n"+t+"/confirmEmail/token\n\nOnce you have confirmed your account, you will be able to login.\n",r=new _email3.default(e.data.email,"userconfirmation@makeup.com","Confirm Account",a,e.res);r.sendTokenEmail(),s.release()}})}):(s.release(),e.res.status(422).json({error:"please provide all fields"}))})})})})}},{key:"login",value:function(){var e=this;pool.getConnection(function(o,s){o&&console.log(o),s.query(e.sql,[e.data.email],function(o,n){o&&(console.log(o),s.release()),n.length>0?bcrypt.compare(e.data.password,n[0].password,function(o,t){o&&(console.log(o),s.release()),t?(console.log("correct."),s.release(),console.log(n[0]),e.res.status(200).json({email:n[0].email,first_name:n[0].first_name,last_name:n[0].last_name,phone:n[0].phone})):(console.log("wrong."),s.release(),e.res.status(422).json({error:"Incorrect Password"}))}):(s.release(),e.res.status(422).json({error:"Email Not Registered"}))})})}}]),e}();exports.default=AuthModel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZGVsL2F1dGhNb2RlbC5qcyJdLCJuYW1lcyI6WyJfZW1haWwyIiwicmVxdWlyZSIsImJjcnlwdCIsInBvb2wiLCJzYWx0Um91bmRzIiwiQXV0aE1vZGVsIiwic3FsIiwiZGF0YSIsInJlcyIsIl9jbGFzc0NhbGxDaGVjayIsInRoaXMiLCJfdGhpcyIsImdldENvbm5lY3Rpb24iLCJlcnIiLCJjb25uZWN0aW9uIiwidG9rZW4iLCJyZXN1bHQiLCJsb2ciLCJyZWxlYXNlIiwiYWZmZWN0ZWRSb3dzIiwic3RhdHVzIiwianNvbiIsInN1Y2Nlc3MiLCJxdWVyeSIsIl90aGlzMiIsImVtYWlsIiwiY29uc29sZSIsImxlbmd0aCIsImVycm9yIiwiZ2VuU2FsdCIsInNhbHQiLCJoYXNoIiwicGFzc3dvcmQiLCJfZGF0YSIsImZpcnN0X25hbWUiLCJsYXN0X25hbWUiLCJwaG9uZSIsInVzZXIiLCJ1cmwiLCJfZW1haWwzIiwiZGVmYXVsdCIsInJlZ2lzdGVyRW1haWxDb250ZW50Iiwic2VuZFRva2VuRW1haWwiLCJfdGhpczMiLCJjb21wYXJlIiwiY29tcGFyaXNvblZhbHVlIl0sIm1hcHBpbmdzIjoiNGZBR0FBLFFBQUFDLFFBQUEsNkRBSElDLE9BQVNELFFBQVEsVUFDakJFLEtBQU9GLFFBQVEsMEJBQ2JHLFdBQWEsR0FHRUMscUJBRW5CLFFBQUFBLEdBQVlDLEVBQUtDLEVBQUtDLEdBQUtDLGdCQUFBQyxLQUFBTCxHQUo3QkssS0FBQUosSUFBQUEsRUFNSUksS0FBS0gsS0FBT0EsRUFDWkcsS0FBS0YsSUFBTUEsNkRBR0MsR0FBQUcsR0FBQUQsSUFFWlAsTUFBS1MsY0FBZSxTQUFDQyxFQUFLQyxHQWYxQlosRUFBU0QsTUFBUVUsRUFBQUwsS0FBckJLLEVBQUFKLEtBQUFRLE9BQUEsU0FBQUYsRUFBQUcsR0FDV2YsSUFDTEcsUUFBYWEsSUFBbkJKLEdBaUJVQyxFQUFXSSxXQVpuQkYsRUFBQUcsYUFBc0JYLEVBQUtHLEVBQUFILElBQUFZLE9BQUEsS0FBQUMsTUFnQmpCQyxTQUFXLElBYmRkLEVBQU1BLElBQVhZLE9BQUEsS0FBQUMsTUFDREMsU0FBQSwyQ0FJTVYsR0FBQUEsR0FBQUEsSUFDSEUsTUFBQUEsY0FBV1MsU0FBWFYsRUFBaUJDLEdBQ2ZBLEVBQUFTLE1BQVNDLEVBQUFsQixLQUFBa0IsRUFBQWpCLEtBQUFrQixPQUFBLFNBQUFaLEVBQUFHLEdBQ1BVLElBQ0FaLFFBQUFBLElBQUFBLEdBQ0RBLEVBQUFJLFdBR0dGLEVBQUFXLE9BQVcsR0FEYWIsRUFBMUJJLFVBR0RNLEVBSkRoQixJQUlPWSxPQUFBLEtBQUFDLE1BQUFPLE1BQUEsWUFFSDFCLE9BQUEyQixRQUFXekIsV0FBQSxTQUFBUyxFQUFBaUIsR0FEYTVCLE9BQTFCNkIsS0FBQVAsRUFBQWpCLEtBQUF5QixTQUFBRixFQUFBLFNBQUFqQixFQUFBa0IsR0FWSlAsRUFBQWpCLEtBQUF5QixTQUFBRCxDQVVJLElBQUFFLEdBTVBULEVBQUFqQixLQUFBa0IsRUFOT1EsRUFNUFIsTUFBQU8sRUFOT0MsRUFNUEQsU0FBQUUsRUFOT0QsRUFNUEMsV0FBQUMsRUFOT0YsRUFNUEUsVUFBQUMsRUFOT0gsRUFNUEcsTUFxQmVDLEdBQVFaLE1BQUFBLEVBQU9PLFNBQUFBLEVBQVVFLFdBQUFBLEVBQVlDLFVBQUFBLEVBQVdDLE1BQUFBLEVBbkJyRFYsU0FBQVQsSUFBQSxPQUFBb0IsR0FDSnpCLEdBQWNvQixHQUFLbEIsR0FBZXFCLEdBQUFDLEVBTy9CcEIsS0FBT1csY0FBWSxTQUFBZCxFQUFBQyxHQUNyQkEsR0FDS04sUUFBSVksSUFBT1AsR0FHZFgsRUFBWXFCLE1BQUtoQiwyQkFBcUI4QixFQUFNTixTQUFBQSxFQUFTZixHQUNuRCxHQUFBSCxFQUNBYSxRQUFVTSxJQUFBQSxHQXVCRmxCLEVBQVdJLGNBekJnQyxDQUk5Q08sR0FKOENhLEdBQUEsbUJBSXZDTixFQUp1QywwTEFBQU0sRUFBQSw0RkFJakJILEVBSmlCLEdBQUFJLFNBQUFDLFFBSWpCTCxFQUppQjVCLEtBQUFrQixNQUFBLDhCQUFBLGtCQUFBZ0IsRUFBQWpCLEVBQUFoQixJQUlONEIsR0FKTU0saUJBZ0MzQzVCLEVBQVdJLGdCQTNDM0JKLEVBQWlCSSxVQUViUSxFQUFRVCxJQUFJSixPQUFaLEtBQUFRLE1BQUFPLE1BQUEsdUVBMkJRLEdBQUFlLEdBQUFqQyxJQUNFZ0IsTUFBQUEsY0FBQUEsU0FBQUEsRUFBQUEsR0FDRGIsR0E2QlhhLFFBQVFULElBQUlKLEdBMUJBQyxFQUFBUyxNQUFBb0IsRUFBSTlCLEtBQUs4QixFQUFBcEMsS0FBQWtCLE9BQUEsU0FBQVosRUFBQUcsR0FDUFUsSUFDQVosUUFBQUEsSUFBQUEsR0FDREEsRUFBQUksV0ErQlRGLEVBQU9XLE9BQVMsRUF4QlB6QixPQUFBMEMsUUFBQUQsRUFBQXBDLEtBQUF5QixTQUFBaEIsRUFBQSxHQUFBZ0IsU0FBQSxTQUFBbkIsRUFBQWdDLEdBQ0ZoQyxJQUVGYSxRQW5CRFQsSUFBQUosR0FvQkRDLEVBQUFJLFdBSU4yQixHQXBESG5CLFFBQUFULElBQUEsWUFERkgsRUFBQUksVUF3RERRLFFBQUFULElBQUFELEVBQUEsSUEyQmEyQixFQUFLbkMsSUFBSVksT0FBTyxLQUFLQyxNQUNuQkksTUFBVVQsRUFBTyxHQUFHUyxNQUNwQlMsV0EzQlJsQixFQUFBLEdBQUFrQixXQUFBQyxVQUFBbkIsRUFBQSxHQUFBbUIsVUE2QlFDLE1BQVVwQixFQUFPLEdBQUdvQixVQXpCL0JWLFFBQUFULElBQUEsVUFDREgsRUFBaUJJLFVBQ1hMLEVBQUtMLElBQUFZLE9BQUEsS0FBQUMsTUFBQU8sTUFBQSwyQkFLVGQsRUFBV2EsVUFDVGdCLEVBQUFuQyxJQUFBWSxPQUFBLEtBQUFDLE1BQUFPLE1BQUEsdURBcEdXdkIiLCJmaWxlIjoibW9kZWwvYXV0aE1vZGVsLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGJjcnlwdCA9IHJlcXVpcmUoJ2JjcnlwdCcpO1xudmFyIHBvb2wgPSByZXF1aXJlKCcuLi8uLi8uLi9kYi9jb25uZWN0LmpzJyk7XG5jb25zdCBzYWx0Um91bmRzID0gMTA7XG5pbXBvcnQgRW1haWwgZnJvbSAnLi4vZW1haWwvZW1haWwuanMnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBdXRoTW9kZWwge1xuXG4gIGNvbnN0cnVjdG9yKHNxbCwgZGF0YSxyZXMpIHtcbiAgICB0aGlzLnNxbCA9IHNxbDtcbiAgICB0aGlzLmRhdGEgPSBkYXRhO1xuICAgIHRoaXMucmVzID0gcmVzO1xuICB9XG5cbiAgY29uZmlybVVzZXIoKSB7XG5cbiAgICBwb29sLmdldENvbm5lY3Rpb24oIChlcnIsIGNvbm5lY3Rpb24pID0+IHtcbiAgICAgIGNvbm5lY3Rpb24ucXVlcnkodGhpcy5zcWwsIFt0aGlzLmRhdGEudG9rZW5dLCAoZXJyLHJlc3VsdCkgPT4ge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICBjb25uZWN0aW9uLnJlbGVhc2UoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzdWx0LmFmZmVjdGVkUm93cyA+IDApIHtcbiAgICAgICAgICB0aGlzLnJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgICAgICAgIFwic3VjY2Vzc1wiOiB0cnVlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5yZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgICBcInN1Y2Nlc3NcIjogZmFsc2VcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSApXG4gICAgfSApO1xuICB9XG5cbiAgcmVnaXN0ZXIoKSB7XG4gICAgcG9vbC5nZXRDb25uZWN0aW9uKChlcnIsY29ubmVjdGlvbikgPT4ge1xuICAgICAgY29ubmVjdGlvbi5xdWVyeSh0aGlzLnNxbCwgW3RoaXMuZGF0YS5lbWFpbF0sIChlcnIscmVzdWx0KSA9PiB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgIGNvbm5lY3Rpb24ucmVsZWFzZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHJlc3VsdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgY29ubmVjdGlvbi5yZWxlYXNlKCk7XG4gICAgICAgICAgdGhpcy5yZXMuc3RhdHVzKDQyMikuanNvbih7J2Vycm9yJzogJ2V4aXN0cyd9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBiY3J5cHQuZ2VuU2FsdChzYWx0Um91bmRzLCAoZXJyLCBzYWx0KSA9PiB7XG4gICAgICAgICAgICBiY3J5cHQuaGFzaCh0aGlzLmRhdGEucGFzc3dvcmQsIHNhbHQsIChlcnIsIGhhc2gpID0+IHtcbiAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhoYXNoKTtcbiAgICAgICAgICAgICAgdGhpcy5kYXRhLnBhc3N3b3JkID0gaGFzaDtcblxuICAgICAgICAgICAgICBsZXQge2VtYWlsLCBwYXNzd29yZCwgZmlyc3RfbmFtZSwgbGFzdF9uYW1lLCBwaG9uZX0gPSB0aGlzLmRhdGE7XG5cbiAgICAgICAgICAgICAgdmFyIHVzZXIgPSB7ZW1haWwsIHBhc3N3b3JkLCBmaXJzdF9uYW1lLCBsYXN0X25hbWUsIHBob25lfTtcblxuICAgICAgICAgICAgICBjb25zb2xlLmxvZygndXNlcicsdXNlcik7XG5cbiAgICAgICAgICAgICAgaWYgKCFlbWFpbCB8fCAhcGFzc3dvcmQgfHwgIWZpcnN0X25hbWUgfHwgIWxhc3RfbmFtZSB8fCAhcGhvbmUpIHtcbiAgICAgICAgICAgICAgICBjb25uZWN0aW9uLnJlbGVhc2UoKTtcbiAgICAgICAgICAgICAgLy8gIGNvbnNvbGUubG9nKHJlcS5ib2R5KTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlcy5zdGF0dXMoNDIyKS5qc29uKCB7IFwiZXJyb3JcIiA6IFwicGxlYXNlIHByb3ZpZGUgYWxsIGZpZWxkc1wifSApO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vcmVzLmpzb24oIHsgXCJzdWNjZXNzXCIgOiB0cnVlfSApO1xuXG4gICAgICAgICAgICAgICAgcG9vbC5nZXRDb25uZWN0aW9uKChlcnIsIGNvbm5lY3Rpb24pID0+IHtcbiAgICAgICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbi5xdWVyeSgnSU5TRVJUIElOVE8gX3VzZXJzIFNFVCA/JywgdXNlciwgKGVyciwgcmVzdWx0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24ucmVsZWFzZSgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgIGxldCB1cmwgPSAnd3d3LnRlc3RzaXRlLmNvbSc7XG4gICAgICAgICAgICAgICAgICAgICAgdmFyIHJlZ2lzdGVyRW1haWxDb250ZW50ID0gJ1lvdSBhcmUgcmVjZWl2aW5nIHRoaXMgYmVjYXVzZSB5b3UgKG9yIHNvbWVvbmUgZWxzZSkgaGF2ZSBzaWduZWQgdXAgdG8gdGhlIHdlYnNpdGUuXFxuXFxuJyArICdQbGVhc2UgY2xpY2sgb24gdGhlIGZvbGxvd2luZyBsaW5rLCBvciBwYXN0ZSB0aGlzIGludG8geW91ciBicm93c2VyIHRvIGNvbXBsZXRlIHRoZSBwcm9jZXNzOlxcblxcbicgKyB1cmwgKyAnL2NvbmZpcm1FbWFpbC8nICsgJ3Rva2VuJyArICdcXG5cXG4nICsgJ09uY2UgeW91IGhhdmUgY29uZmlybWVkIHlvdXIgYWNjb3VudCwgeW91IHdpbGwgYmUgYWJsZSB0byBsb2dpbi5cXG4nO1xuXG4gICAgICAgICAgICAgICAgICAgICAgbGV0IGVtYWlsID0gbmV3IEVtYWlsKHRoaXMuZGF0YS5lbWFpbCwgJ3VzZXJjb25maXJtYXRpb25AbWFrZXVwLmNvbScsICdDb25maXJtIEFjY291bnQnLCByZWdpc3RlckVtYWlsQ29udGVudCwgdGhpcy5yZXMgKTtcbiAgICAgICAgICAgICAgICAgICAgICBlbWFpbC5zZW5kVG9rZW5FbWFpbCgpO1xuICAgICAgICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24ucmVsZWFzZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGxvZ2luKCkge1xuICAgIHBvb2wuZ2V0Q29ubmVjdGlvbigoZXJyLGNvbm5lY3Rpb24pID0+IHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgIH1cbiAgICAgIGNvbm5lY3Rpb24ucXVlcnkodGhpcy5zcWwsIFt0aGlzLmRhdGEuZW1haWxdLCAoZXJyLHJlc3VsdCkgPT4ge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgICBjb25uZWN0aW9uLnJlbGVhc2UoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCkge1xuICAgICAgICAgIC8vZG8gc29tZXRoaW5nIGlmIGVtYWlsIGV4aXN0c1xuXG4gICAgICAgICAgLy8gTG9hZCBoYXNoIGZyb20geW91ciBwYXNzd29yZCBEQi5cbiAgICAgICAgICBiY3J5cHQuY29tcGFyZSh0aGlzLmRhdGEucGFzc3dvcmQsIHJlc3VsdFswXS5wYXNzd29yZCwgKGVyciwgY29tcGFyaXNvblZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24ucmVsZWFzZSgpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKGNvbXBhcmlzb25WYWx1ZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjb3JyZWN0LicpO1xuICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24ucmVsZWFzZSgpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdFswXSk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgICAgICAgICAgICAgICBcImVtYWlsXCIgOiByZXN1bHRbMF0uZW1haWwsXG4gICAgICAgICAgICAgICAgICBcImZpcnN0X25hbWVcIiA6IHJlc3VsdFswXS5maXJzdF9uYW1lLFxuICAgICAgICAgICAgICAgICAgXCJsYXN0X25hbWVcIiA6IHJlc3VsdFswXS5sYXN0X25hbWUsXG4gICAgICAgICAgICAgICAgICBcInBob25lXCIgOiByZXN1bHRbMF0ucGhvbmVcbiAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnd3JvbmcuJyk7XG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbi5yZWxlYXNlKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXMuc3RhdHVzKDQyMikuanNvbigge1wiZXJyb3JcIjogJ0luY29ycmVjdCBQYXNzd29yZCd9ICk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbm5lY3Rpb24ucmVsZWFzZSgpO1xuICAgICAgICAgIHRoaXMucmVzLnN0YXR1cyg0MjIpLmpzb24oIHtcImVycm9yXCI6ICdFbWFpbCBOb3QgUmVnaXN0ZXJlZCd9ICk7XG4gICAgICAgIH1cblxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxufVxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9

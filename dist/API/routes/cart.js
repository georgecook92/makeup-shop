"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _asyncToGenerator(t){return function(){var r=t.apply(this,arguments);return new Promise(function(t,e){function n(o,c){try{var a=r[o](c),u=a.value}catch(t){return void e(t)}return a.done?void t(u):Promise.resolve(u).then(function(t){n("next",t)},function(t){n("throw",t)})}return n("next")})}}var _cartModel=require("../model/cartModel.js"),_cartModel2=_interopRequireDefault(_cartModel),express=require("express"),router=express.Router();router.get("/getCart",function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(r,e,n){var o,c,a,u,d,i,_,s,p,l;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o="SELECT * FROM _cart where user_id = ?",c=r.get("Authorization")||"test",a=new _cartModel2.default(r.body,n,c,o),t.next=6,a.checkCartExist();case 6:if(u=t.sent,0===u.length){t.next=16;break}return d="SELECT _product.product_id, _product.product_name, _product.price, _cart_product.quantity, _product.discount  FROM _cart inner join _cart_product on _cart_product.cart_id = _cart.cart_id inner join _product on _product.product_id = _cart_product.product_id where user_id = ?",i=new _cartModel2.default(r.body,n,c,d),t.next=12,i.getCart();case 12:_=t.sent,e.json({data:_,cartId:u[0].cart_id}),t.next=22;break;case 16:return s="insert into _cart SET user_id=?",p=new _cartModel2.default(r.body,n,c,s),t.next=20,p.createCart();case 20:l=t.sent,e.json([]);case 22:t.next=27;break;case 24:t.prev=24,t.t0=t.catch(0),console.log(t.t0);case 27:case"end":return t.stop()}},t,void 0,[[0,24]])}));return function(r,e,n){return t.apply(this,arguments)}}()),router.post("/addToCart",function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(r,e,n){var o,c,a,u,d,i,_,s,p,l,f,h,x,v,w,y;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o="SELECT * FROM _cart_product where cart_id = ? AND product_id = ?",c=r.get("Authorization")||"",a=new _cartModel2.default(r.body,n,c,o),t.next=6,a.checkCartProduct();case 6:if(u=t.sent,console.log("check",u),d=void 0,!(u.length>0)){t.next=18;break}return i=u[0].quantity+r.body.quantity,_="UPDATE _cart_product SET quantity = "+i+" where cart_id = ? AND product_id = ?",s=new _cartModel2.default(r.body,n,c,_),t.next=15,s.updateCartProduct();case 15:d=t.sent,t.next=23;break;case 18:return p="INSERT INTO _cart_product SET ?",l=new _cartModel2.default(r.body,n,c,p),t.next=22,l.addToCart();case 22:d=t.sent;case 23:return f="SELECT * FROM _cart where user_id = ?",h=new _cartModel2.default(r.body,n,c,f),t.next=27,h.checkCartExist();case 27:return x=t.sent,v="SELECT _product.product_id, _product.product_name, _product.price, _cart_product.quantity, _product.discount  FROM _cart inner join _cart_product on _cart_product.cart_id = _cart.cart_id inner join _product on _product.product_id = _cart_product.product_id where user_id = ?",w=new _cartModel2.default(r.body,n,c,v),t.next=32,w.getCart();case 32:y=t.sent,e.json({data:y,cartId:x[0].cart_id}),t.next=39;break;case 36:t.prev=36,t.t0=t.catch(0),console.log(t.t0);case 39:case"end":return t.stop()}},t,void 0,[[0,36]])}));return function(r,e,n){return t.apply(this,arguments)}}()),router.post("/deleteFromCart",function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(r,e,n){var o,c,a,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o="DELETE FROM _cart_product where cart_id = ? AND product_id = ?",c=r.get("Authorization")||"",a=new _cartModel2.default(r.body,n,c,o),t.next=6,a.deleteFromCart();case 6:u=t.sent,e.json(u),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),console.log(t.t0);case 13:case"end":return t.stop()}},t,void 0,[[0,10]])}));return function(r,e,n){return t.apply(this,arguments)}}()),module.exports=router;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJvdXRlcy9jYXJ0LmpzIl0sIm5hbWVzIjpbIl9jYXJ0TW9kZWwiLCJyZXF1aXJlIiwiZXhwcmVzcyIsInJvdXRlciIsIlJvdXRlciIsImdldCIsIl9yZWYiLCJfYXN5bmNUb0dlbmVyYXRvciIsInJlZ2VuZXJhdG9yUnVudGltZSIsIm1hcmsiLCJfY2FsbGVlIiwicmVxIiwicmVzIiwibmV4dCIsImVtYWlsQ2hlY2tTUUwiLCJ0b2tlbiIsIk1vZGVsIiwiY2FydEV4aXN0IiwiZ2V0Q2FydFNRTCIsImNhcnRNb2RlbCIsInJlc3VsdCIsImNyZWF0ZUNhcnRTUUwiLCJDcmVhdGVDYXJ0TW9kZWwiLCJjcmVhdGVkQ2FydCIsIndyYXAiLCJfY29udGV4dCIsInByZXYiLCJfY2FydE1vZGVsMiIsImRlZmF1bHQiLCJib2R5IiwiY2hlY2tDYXJ0RXhpc3QiLCJzZW50IiwiZ2V0Q2FydCIsImpzb24iLCJkYXRhIiwiY2FydElkIiwiY2FydF9pZCIsImNyZWF0ZUNhcnQiLCJ0MCIsInN0b3AiLCJ1bmRlZmluZWQiLCJfeCIsIl94MiIsIl94MyIsImFwcGx5IiwidGhpcyIsImFyZ3VtZW50cyIsIl9jYWxsZWUyIiwiY2hlY2tTUUwiLCJDaGVja0NhcnRNb2RlbCIsImNoZWNrIiwicXVhbnRpdHkiLCJhZGRTUUwiLCJVcGRhdGVDYXJ0TW9kZWwiLCJfYWRkU1FMIiwiQWRkQ2FydE1vZGVsIiwiY2FydENoZWNrU1FMIiwiX2NvbnRleHQyIiwiY2hlY2tDYXJ0UHJvZHVjdCIsImxlbmd0aCIsInVwZGF0ZUNhcnRQcm9kdWN0IiwiYWRkVG9DYXJ0IiwiY29uc29sZSIsImxvZyIsInBvc3QiLCJfcmVmMyIsIl9jYWxsZWUzIiwiU1FMIiwiX2NvbnRleHQzIiwiZGVsZXRlRnJvbUNhcnQiLCJfeDciLCJfeDgiLCJfeDkiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoia1lBRUEsR0FBQUEsWUFBQUMsUUFBQSx3RUFGSUMsUUFBVUQsUUFBUSxXQUNsQkUsT0FBU0Qs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T0FBQVosb0JBQUFnQixLQUFBLFNBQUE0QyxHQUFBLE9BQUEsT0FBQUEsRUFBQTFDLEtBQUEwQyxFQUFBdkQsTUFBQSxJQUFBLEdBQUEsTUFBQXVELEdBQUExQyxLQUFBLEVBK0RieUMsRUFBTSxpRUEzQ1pMLEVBQUFBLEVBQVFDLElBQVIsa0JBQUEsR0E2Q00vQyxFQUFRLEdBQUFXLGFBQUFDLFFBQWNqQixFQUFJa0IsS0FBTWhCLEVBQU1FLEVBQU9vRCxHQWpFaENDLEVBQUF2RCxLQUFBLEVBQUFHLEVBQUFxRCxnQkFBQSxLQUFBLEdBQUFqRCxFQUFBZ0QsRUFBQXJDLEtBQUFuQixFQUFBcUIsS0FBQWIsR0FBQWdELEVBQUF2RCxLQUFBLEVBQUEsTUFBQSxLQUFBLElBQUF1RCxFQUFBMUMsS0FBQSxHQUFBMEMsRUFBQTlCLEdBQUE4QixFQUFBLE1BQUEsR0FBQU4sUUFBQUMsSUFBQUssRUFBQTlCLEdBQUEsS0FBQSxJQUFBLElBQUEsTUFBQSxNQUFBOEIsR0FBQTdCLFNBQUEyQixFQUFBMUIsU0FBQSxFQUFBLFFBQUEsT0FBQSxVQUFBOEIsRUFBQUMsRUFBQUMsR0FBQSxNQUFBUCxHQUFBckIsTUFBQUMsS0FBQUMsZ0JBeUV2QjJCLE9BQU9DLFFBQVV2RSIsImZpbGUiOiJyb3V0ZXMvY2FydC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xudmFyIHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5pbXBvcnQgQ2FydE1vZGVsIGZyb20gJy4uL21vZGVsL2NhcnRNb2RlbC5qcyc7XG5cbnJvdXRlci5nZXQoJy9nZXRDYXJ0JywgYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgZW1haWxDaGVja1NRTCA9ICdTRUxFQ1QgKiBGUk9NIF9jYXJ0IHdoZXJlIHVzZXJfaWQgPSA/JztcbiAgICBjb25zdCB0b2tlbiA9IHJlcS5nZXQoJ0F1dGhvcml6YXRpb24nKSB8fCBcInRlc3RcIjtcbiAgICBjb25zdCBNb2RlbCA9IG5ldyBDYXJ0TW9kZWwocmVxLmJvZHksIG5leHQsIHRva2VuLCBlbWFpbENoZWNrU1FMKTtcbiAgICBjb25zdCBjYXJ0RXhpc3QgPSBhd2FpdCBNb2RlbC5jaGVja0NhcnRFeGlzdCgpO1xuXG4gICAgaWYgKGNhcnRFeGlzdC5sZW5ndGggIT09IDApIHtcbiAgICAgIGNvbnN0IGdldENhcnRTUUwgPSAnU0VMRUNUIF9wcm9kdWN0LnByb2R1Y3RfaWQsIF9wcm9kdWN0LnByb2R1Y3RfbmFtZSwgX3Byb2R1Y3QucHJpY2UsIF9jYXJ0X3Byb2R1Y3QucXVhbnRpdHksIF9wcm9kdWN0LmRpc2NvdW50ICBGUk9NIF9jYXJ0IGlubmVyIGpvaW4gX2NhcnRfcHJvZHVjdCBvbiBfY2FydF9wcm9kdWN0LmNhcnRfaWQgPSBfY2FydC5jYXJ0X2lkIGlubmVyIGpvaW4gX3Byb2R1Y3Qgb24gX3Byb2R1Y3QucHJvZHVjdF9pZCA9IF9jYXJ0X3Byb2R1Y3QucHJvZHVjdF9pZCB3aGVyZSB1c2VyX2lkID0gPyc7XG4gICAgICB2YXIgY2FydE1vZGVsID0gbmV3IENhcnRNb2RlbChyZXEuYm9keSwgbmV4dCwgdG9rZW4sIGdldENhcnRTUUwpO1xuICAgICAgdmFyIHJlc3VsdCA9IGF3YWl0IGNhcnRNb2RlbC5nZXRDYXJ0KCk7XG4gICAgICAvLyB3aWxsIHJldHVybiBhIHN1Y2Nlc3MgdmFsdWUgYW5kIGRhdGEgaWYgc3VjY2VzcyA9PSB0cnVlXG4gICAgICByZXMuanNvbih7ZGF0YTogcmVzdWx0LCBjYXJ0SWQ6IGNhcnRFeGlzdFswXS5jYXJ0X2lkfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBjcmVhdGVDYXJ0U1FMID0gJ2luc2VydCBpbnRvIF9jYXJ0IFNFVCB1c2VyX2lkPT8nO1xuICAgICAgdmFyIENyZWF0ZUNhcnRNb2RlbCA9IG5ldyBDYXJ0TW9kZWwocmVxLmJvZHksIG5leHQsIHRva2VuLCBjcmVhdGVDYXJ0U1FMKTtcbiAgICAgIGNvbnN0IGNyZWF0ZWRDYXJ0ID0gYXdhaXQgQ3JlYXRlQ2FydE1vZGVsLmNyZWF0ZUNhcnQoKTtcbiAgICAgIHJlcy5qc29uKFtdKTtcbiAgICB9XG4gIH0gY2F0Y2goZSkge1xuICAgIGNvbnNvbGUubG9nKGUpO1xuICB9XG5cbn0pO1xuXG5yb3V0ZXIucG9zdChcIi9hZGRUb0NhcnRcIiwgYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIHRyeSB7XG4gICAgLy8gY2hlY2sgaWYgcHJvZHVjdCBpcyBhbHJlYWR5IGluIGNhcnQgLSBpZiBzbyB1cGRhdGUgaXQgLSBlbHNlIGFkZCBpdFxuXG4gICAgY29uc3QgY2hlY2tTUUwgPSBcIlNFTEVDVCAqIEZST00gX2NhcnRfcHJvZHVjdCB3aGVyZSBjYXJ0X2lkID0gPyBBTkQgcHJvZHVjdF9pZCA9ID9cIjtcbiAgICBjb25zdCB0b2tlbiA9IHJlcS5nZXQoJ0F1dGhvcml6YXRpb24nKSB8fCBcIlwiO1xuICAgIGNvbnN0IENoZWNrQ2FydE1vZGVsID0gbmV3IENhcnRNb2RlbChyZXEuYm9keSwgbmV4dCwgdG9rZW4sIGNoZWNrU1FMKTtcbiAgICBjb25zdCBjaGVjayA9IGF3YWl0IENoZWNrQ2FydE1vZGVsLmNoZWNrQ2FydFByb2R1Y3QoKTtcbiAgICBjb25zb2xlLmxvZygnY2hlY2snLCBjaGVjayk7XG4gICAgbGV0IHJlc3VsdDtcblxuICAgIGlmIChjaGVjay5sZW5ndGggPiAwKSB7XG4gICAgICAvLyB0b3RhbCBxdWFudGl0eVxuICAgICAgY29uc3QgcXVhbnRpdHkgPSBjaGVja1swXS5xdWFudGl0eSArIHJlcS5ib2R5LnF1YW50aXR5O1xuICAgICAgLy8gdXBkYXRlIGNhcnRcbiAgICAgIGNvbnN0IGFkZFNRTCA9IFwiVVBEQVRFIF9jYXJ0X3Byb2R1Y3QgU0VUIHF1YW50aXR5ID0gXCIgKyBxdWFudGl0eSArIFwiIHdoZXJlIGNhcnRfaWQgPSA/IEFORCBwcm9kdWN0X2lkID0gP1wiO1xuICAgICAgdmFyIFVwZGF0ZUNhcnRNb2RlbCA9IG5ldyBDYXJ0TW9kZWwocmVxLmJvZHksIG5leHQsIHRva2VuLCBhZGRTUUwpO1xuICAgICAgcmVzdWx0ID0gYXdhaXQgVXBkYXRlQ2FydE1vZGVsLnVwZGF0ZUNhcnRQcm9kdWN0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGFkZFNRTCA9IFwiSU5TRVJUIElOVE8gX2NhcnRfcHJvZHVjdCBTRVQgP1wiO1xuICAgICAgdmFyIEFkZENhcnRNb2RlbCA9IG5ldyBDYXJ0TW9kZWwocmVxLmJvZHksIG5leHQsIHRva2VuLCBhZGRTUUwpO1xuICAgICAgcmVzdWx0ID0gYXdhaXQgQWRkQ2FydE1vZGVsLmFkZFRvQ2FydCgpO1xuICAgIH1cblxuICAgIGNvbnN0IGNhcnRDaGVja1NRTCA9ICdTRUxFQ1QgKiBGUk9NIF9jYXJ0IHdoZXJlIHVzZXJfaWQgPSA/JztcbiAgICBjb25zdCBNb2RlbCA9IG5ldyBDYXJ0TW9kZWwocmVxLmJvZHksIG5leHQsIHRva2VuLCBjYXJ0Q2hlY2tTUUwpO1xuICAgIGNvbnN0IGNhcnRFeGlzdCA9IGF3YWl0IE1vZGVsLmNoZWNrQ2FydEV4aXN0KCk7XG4gICAgY29uc3QgZ2V0Q2FydFNRTCA9ICdTRUxFQ1QgX3Byb2R1Y3QucHJvZHVjdF9pZCwgX3Byb2R1Y3QucHJvZHVjdF9uYW1lLCBfcHJvZHVjdC5wcmljZSwgX2NhcnRfcHJvZHVjdC5xdWFudGl0eSwgX3Byb2R1Y3QuZGlzY291bnQgIEZST00gX2NhcnQgaW5uZXIgam9pbiBfY2FydF9wcm9kdWN0IG9uIF9jYXJ0X3Byb2R1Y3QuY2FydF9pZCA9IF9jYXJ0LmNhcnRfaWQgaW5uZXIgam9pbiBfcHJvZHVjdCBvbiBfcHJvZHVjdC5wcm9kdWN0X2lkID0gX2NhcnRfcHJvZHVjdC5wcm9kdWN0X2lkIHdoZXJlIHVzZXJfaWQgPSA/JztcbiAgICB2YXIgY2FydE1vZGVsID0gbmV3IENhcnRNb2RlbChyZXEuYm9keSwgbmV4dCwgdG9rZW4sIGdldENhcnRTUUwpO1xuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBjYXJ0TW9kZWwuZ2V0Q2FydCgpO1xuICAgIHJlcy5qc29uKHtkYXRhOiBkYXRhLCBjYXJ0SWQ6IGNhcnRFeGlzdFswXS5jYXJ0X2lkfSk7XG4gIH0gY2F0Y2goZSkge1xuICAgIGNvbnNvbGUubG9nKGUpO1xuICB9XG59KTtcblxucm91dGVyLnBvc3QoXCIvZGVsZXRlRnJvbUNhcnRcIiwgYXN5bmMgKHJlcSxyZXMsbmV4dCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IFNRTCA9IFwiREVMRVRFIEZST00gX2NhcnRfcHJvZHVjdCB3aGVyZSBjYXJ0X2lkID0gPyBBTkQgcHJvZHVjdF9pZCA9ID9cIjtcbiAgICBjb25zdCB0b2tlbiA9IHJlcS5nZXQoJ0F1dGhvcml6YXRpb24nKSB8fCBcIlwiO1xuICAgIGNvbnN0IE1vZGVsID0gbmV3IENhcnRNb2RlbChyZXEuYm9keSwgbmV4dCwgdG9rZW4sIFNRTCk7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgTW9kZWwuZGVsZXRlRnJvbUNhcnQoKTtcbiAgICByZXMuanNvbihyZXN1bHQpO1xuICB9IGNhdGNoKGUpIHtcbiAgICBjb25zb2xlLmxvZyhlKTtcbiAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gcm91dGVyO1xuIl19

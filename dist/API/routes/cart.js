"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(o,a){try{var c=r[o](a),u=c.value}catch(e){return void t(e)}return c.done?void e(u):Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}var _cartModel=require("../model/cartModel.js"),_cartModel2=_interopRequireDefault(_cartModel),express=require("express"),router=express.Router();router.get("/getCart",function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(r,t,n){var o,a,c,u,s,i,d,l,_,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o="SELECT * FROM _cart where user_id = ?",a=r.get("Authorization")||"",c=new _cartModel2.default(r.body,n,a,o),e.next=6,c.checkCartExist();case 6:if(u=e.sent,console.log("cart exist",u),!u.success){e.next=19;break}return console.log("SUCCESS"),s="SELECT * FROM _cart inner join _cart_product on _cart_product.cart_id = _cart.cart_id where user_id = ?",i=new _cartModel2.default(r.body,n,a,s),e.next=14,i.getCart();case 14:d=e.sent,console.log("RESULT",d),t.json(d),e.next=25;break;case 19:return l="insert into _cart SET user_id=?",_=new _cartModel2.default(r.body,n,a,l),e.next=23,_.createCart();case 23:p=e.sent,t.json({success:!1});case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(0),console.log(e.t0);case 30:case"end":return e.stop()}},e,void 0,[[0,27]])}));return function(r,t,n){return e.apply(this,arguments)}}()),router.post("/addToCart",function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(r,t,n){var o,a,c,u,s,i,d,l,_;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o="SELECT * FROM _cart_product where cart_id = ? AND product_id = ?",a=r.get("Authorization")||"",c=new _cartModel2.default(r.body,n,a,o),e.next=6,c.checkCartProduct();case 6:if(u=e.sent,s=null,!(u.length>0)){e.next=16;break}return i="UPDATE _cart_product SET quantity = ? where cart_id = ? AND product_id = ?",d=new _cartModel2.default(r.body,n,a,i),e.next=13,d.updateCartProduct();case 13:s=e.sent,e.next=21;break;case 16:return l="INSERT INTO _cart_product SET ?",_=new _cartModel2.default(r.body,n,a,l),e.next=20,_.addToCart();case 20:s=e.sent;case 21:t.json(s),e.next=27;break;case 24:e.prev=24,e.t0=e.catch(0),console.log(e.t0);case 27:case"end":return e.stop()}},e,void 0,[[0,24]])}));return function(r,t,n){return e.apply(this,arguments)}}()),router.post("/deleteFromCart",function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(r,t,n){var o,a,c,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o="DELETE FROM _cart_product where cart_id = ? AND product_id = ?",a=r.get("Authorization")||"",c=new _cartModel2.default(r.body,n,a,o),e.next=6,c.deleteFromCart();case 6:u=e.sent,t.json(u),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}},e,void 0,[[0,10]])}));return function(r,t,n){return e.apply(this,arguments)}}()),module.exports=router;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJvdXRlcy9jYXJ0LmpzIl0sIm5hbWVzIjpbIl9jYXJ0TW9kZWwiLCJyZXF1aXJlIiwiZXhwcmVzcyIsInJvdXRlciIsIlJvdXRlciIsImdldCIsIl9yZWYiLCJfYXN5bmNUb0dlbmVyYXRvciIsInJlZ2VuZXJhdG9yUnVudGltZSIsIm1hcmsiLCJfY2FsbGVlIiwicmVxIiwicmVzIiwibmV4dCIsImVtYWlsQ2hlY2tTUUwiLCJ0b2tlbiIsIk1vZGVsIiwiY2FydEV4aXN0IiwiZ2V0Q2FydFNRTCIsImNhcnRNb2RlbCIsInJlc3VsdCIsImNyZWF0ZUNhcnRTUUwiLCJDcmVhdGVDYXJ0TW9kZWwiLCJjcmVhdGVkQ2FydCIsIndyYXAiLCJfY29udGV4dCIsInByZXYiLCJfY2FydE1vZGVsMiIsImRlZmF1bHQiLCJib2R5IiwiY2hlY2tDYXJ0RXhpc3QiLCJzZW50Iiwic3VjY2VzcyIsImNvbnNvbGUiLCJsb2ciLCJnZXRDYXJ0IiwianNvbiIsImNyZWF0ZUNhcnQiLCJ0MCIsInN0b3AiLCJ1bmRlZmluZWQiLCJfeCIsIl94MiIsIl94MyIsImFwcGx5IiwidGhpcyIsImFyZ3VtZW50cyIsInBvc3QiLCJfcmVmMiIsIl9jYWxsZWUyIiwiY2hlY2tTUUwiLCJDaGVja0NhcnRNb2RlbCIsImNoZWNrIiwiYWRkU1FMIiwiVXBkYXRlQ2FydE1vZGVsIiwiX2FkZFNRTCIsIkFkZENhcnRNb2RlbCIsIl9jb250ZXh0MiIsImNoZWNrQ2FydFByb2R1Y3QiLCJsZW5ndGgiLCJ1cGRhdGVDYXJ0UHJvZHVjdCIsImFkZFRvQ2FydCIsIl94NCIsIl94NSIsIl94NiIsIl9yZWYzIiwiX2NhbGxlZTMiLCJTUUwiLCJfY29udGV4dDMiLCJkZWxldGVGcm9tQ2FydCIsIl94NyIsIl94OCIsIl94OSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJrWUFFQSxHQUFBQSxZQUFBQyxRQUFBLHdFQUZJQyxRQUFVRCxRQUFRLFdBQ2xCRSxPQUFTRCxRQUFRRSxRQUdyQkQsUUFBT0UsSUFBSSxXQUFYLFdBQUEsR0FBQUMsR0FBQUMsa0JBQUFDLG1CQUFBQyxLQUF1QixRQUFBQyxHQUFPQyxFQUFLQyxFQUFLQyxHQUFqQixHQUFBQyxHQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxDQUFBLE9BQUFmLG9CQUFBZ0IsS0FBQSxTQUFBQyxHQUFBLE9BQUEsT0FBQUEsRUFBQUMsS0FBQUQsRUFBQVosTUFBQSxJQUFBLEdBQUEsTUFBQVksR0FBQUMsS0FBQSxFQUViWixFQUFnQix3Q0FDaEJDLEVBQVFKLEVBQUlOLElBQUksa0JBQW9CLEdBQ3BDVyxFQUFRLEdBQUFXLGFBQUFDLFFBQWNqQixFQUFJa0IsS0FBTWhCLEVBQU1FLEVBQU9ELEdBSmhDVyxFQUFBWixLQUFBLEVBS0tHLEVBQU1jLGdCQUxYLEtBQUEsR0FBQSxHQUtiYixFQUxhUSxFQUFBTSxLQUpuQjdCLFFBQUFBLElBQVVELGFBQVFnQixJQVlkQSxFQUFVZSxRQVJLLENBQUFQLEVBQUFaLEtBQUEsRUFBQSxPQUFBLE1BU2pCb0IsU0FBUUMsSUFBSSxXQVRQaEIsRUFBWCwwR0FBQUMsRUFBQSxHQUFBUSxhQUFBQyxRQUFBakIsRUFBQWtCLEtBQUFoQixFQUFBRSxFQUF1QkcsR0FBQU8sRUFBQVosS0FBQSxHQUFBTSxFQUFBZ0IsU0FBQSxLQUFBLElBQUFmLEVBQUFLLEVBQUFNLEtBQUFFLFFBQUFDLElBQUEsU0FBQWQsR0FBQVIsRUFBQXdCLEtBQUFoQixHQUFBSyxFQUFBWixLQUFBLEVBQUEsTUFBQSxLQUFBLElBQUEsTUFBQVEsR0FBQSxrQ0FFYlAsRUFBZ0IsR0FBQWEsYUFBQUMsUUFBQWpCLEVBQUFrQixLQUFBaEIsRUFBQUUsRUFBQU0sR0FGSEksRUFBQVosS0FBQSxHQUdHUyxFQUFvQmUsWUFIdkIsS0FBQSxJQUdidEIsRUFIYVUsRUFBQU0sS0FJYmYsRUFBQUEsTUFBQUEsU0FBUSxHQUpLLEtBQUEsSUFBQVMsRUFBQVosS0FBQSxFQUFBLE1BQUEsS0FBQSxJQUFBWSxFQUFBQyxLQUFBLEdBQUFELEVBQUFhLEdBQUFiLEVBQUEsTUFBQSxHQXVCbkJRLFFBQVFDLElBQVJULEVBQUFhLEdBdkJtQixLQUFBLElBQUEsSUFBQSxNQUFBLE1BQUFiLEdBQUFjLFNBQUE3QixFQUFBOEIsU0FBQSxFQUFBLFFBQXZCLE9BQUEsVUFBQUMsRUFBQUMsRUFBQUMsR0FBQSxNQUFBckMsR0FBQXNDLE1BQUFDLEtBQUFDLGdCQTRCQTNDLE9BQU80QyxLQUFLLGFBQVosV0FBQSxHQUFBQyxHQUFBekMsa0JBQUFDLG1CQUFBQyxLQUEwQixRQUFBd0MsR0FBT3RDLEVBQUtDLEVBQUtDLEdBQWpCLEdBQUFxQyxHQUFBbkMsRUFBQW9DLEVBQUFDLEVBQUFoQyxFQUFBaUMsRUFBQUMsRUFBQUMsRUFBQUMsQ0FBQSxPQUFBaEQsb0JBQUFnQixLQUFBLFNBQUFpQyxHQUFBLE9BQUEsT0FBQUEsRUFBQS9CLEtBQUErQixFQUFBNUMsTUFBQSxJQUFBLEdBQUEsTUFBQTRDLEdBQUEvQixLQUFBLEVBNUJId0IsRUFBQSxtRUFpQ2JuQyxFQUFRSixFQUFJTixJQUFJLGtCQUFvQixHQXhCeEM0QixFQUFZLEdBQUFOLGFBQUFDLFFBQVpqQixFQUFBa0IsS0FBQWhCLEVBQUFFLEVBQUFtQyxHQW1Cb0JPLEVBQUE1QyxLQUFBLEVBNUJIc0MsRUFVRU8sa0JBa0JDLEtBQUEsR0FBQSxHQWxCZHhDLEVBa0JjdUMsRUFBQTFCLEtBakJoQlosRUFBQUEsT0FYYWlDLEVBQUFPLE9BWUV4QyxHQWdCQyxDQUFBc0MsRUFBQTVDLEtBQUEsRUFBQSxPQUFBLE1BNUJId0MsR0FBQSw2RUFZYmpDLEVBWmEsR0FBQU8sYUFBQUMsUUFBQWpCLEVBQUFrQixLQUFBaEIsRUFBQUUsRUFBQXNDLEdBNEJHSSxFQUFBNUMsS0FBQSxHQWNMeUMsRUFBZ0JNLG1CQWRYLEtBQUEsSUFjcEJ4QyxFQWRvQnFDLEVBQUExQixLQUFBMEIsRUFBQTVDLEtBQUEsRUFBQSxNQUFBLEtBQUEsSUFBQSxNQWRwQndDLEdBQUEsa0NBQ0F6QyxFQUFTUSxHQUFBQSxhQUFBQSxRQUFUVCxFQUFBa0IsS0FBQWhCLEVBQUFFLEVBQUFzQyxHQWFvQkksRUFBQTVDLEtBQUEsR0E1QkgyQyxFQUFBSyxXQTRCRyxLQUFBLElBNUJIekMsRUE0QkdxQyxFQUFBMUIsSUFBQSxLQUFBLElBNUJIbkIsRUFBQXdCLEtBQUFoQixHQTRCR3FDLEVBQUE1QyxLQUFBLEVBQUEsTUFBQSxLQUFBLElBQUE0QyxFQUFBL0IsS0FBQSxHQUFBK0IsRUFBQW5CLEdBQUFtQixFQUFBLE1BQUEsR0FWaEJuQyxRQUFBQSxJQUFBQSxFQUFBQSxHQVVnQixLQUFBLElBQUEsSUFBQSxNQUFBLE1BQUFtQyxHQUFBbEIsU0FBQVUsRUFBQVQsU0FBQSxFQUFBLFFBQTFCLE9BQUEsVUFBQXNCLEVBQUFDLEVBQUFDLEdBQUEsTUFBQWhCLEdBQUFKLE1BQUFDLEtBQUFDLGdCQTVCdUIzQyxPQUFBNEMsS0FBQSxrQkFBQSxXQUFBLEdBQUFrQixHQUFBMUQsa0JBQUFDLG1CQUFBQyxLQUFBLFFBQUF5RCxHQUFBdkQsRUFBQUMsRUFBQUMsR0FBQSxHQUFBc0QsR0FBQXBELEVBQUFDLEVBQUFJLENBQUEsT0FBQVosb0JBQUFnQixLQUFBLFNBQUE0QyxHQUFBLE9BQUEsT0FBQUEsRUFBQTFDLEtBQUEwQyxFQUFBdkQsTUFBQSxJQUFBLEdBQUEsTUFBQXVELEdBQUExQyxLQUFBLEVBeURieUMsRUFBTSxpRUFyQ1Z2RCxFQUFJd0IsRUFBSy9CLElBQUMsa0JBQVYsR0F1Q0lXLEVBQVEsR0FBQVcsYUFBQUMsUUFBY2pCLEVBQUlrQixLQUFNaEIsRUFBTUUsRUFBT29ELEdBM0RoQ0MsRUFBQXZELEtBQUEsRUFBQUcsRUFBQXFELGdCQUFBLEtBQUEsR0FBQWpELEVBQUFnRCxFQUFBckMsS0FBQW5CLEVBQUF3QixLQUFBaEIsR0FBQWdELEVBQUF2RCxLQUFBLEVBQUEsTUFBQSxLQUFBLElBQUF1RCxFQUFBMUMsS0FBQSxHQUFBMEMsRUFBQTlCLEdBQUE4QixFQUFBLE1BQUEsR0ErRG5CbkMsUUFBUUMsSUFBUmtDLEVBQUE5QixHQS9EbUIsS0FBQSxJQUFBLElBQUEsTUFBQSxNQUFBOEIsR0FBQTdCLFNBQUEyQixFQUFBMUIsU0FBQSxFQUFBLFFBQUEsT0FBQSxVQUFBOEIsRUFBQUMsRUFBQUMsR0FBQSxNQUFBUCxHQUFBckIsTUFBQUMsS0FBQUMsZ0JBbUV2QjJCLE9BQU9DLFFBQVV2RSIsImZpbGUiOiJyb3V0ZXMvY2FydC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xudmFyIHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5pbXBvcnQgQ2FydE1vZGVsIGZyb20gJy4uL21vZGVsL2NhcnRNb2RlbC5qcyc7XG5cbnJvdXRlci5nZXQoJy9nZXRDYXJ0JywgYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgZW1haWxDaGVja1NRTCA9ICdTRUxFQ1QgKiBGUk9NIF9jYXJ0IHdoZXJlIHVzZXJfaWQgPSA/JztcbiAgICBjb25zdCB0b2tlbiA9IHJlcS5nZXQoJ0F1dGhvcml6YXRpb24nKSB8fCBcIlwiO1xuICAgIGNvbnN0IE1vZGVsID0gbmV3IENhcnRNb2RlbChyZXEuYm9keSwgbmV4dCwgdG9rZW4sIGVtYWlsQ2hlY2tTUUwpO1xuICAgIGNvbnN0IGNhcnRFeGlzdCA9IGF3YWl0IE1vZGVsLmNoZWNrQ2FydEV4aXN0KCk7XG4gICAgY29uc29sZS5sb2coXCJjYXJ0IGV4aXN0XCIsIGNhcnRFeGlzdCk7XG5cbiAgICBpZiAoY2FydEV4aXN0LnN1Y2Nlc3MpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiU1VDQ0VTU1wiKTtcbiAgICAgIGNvbnN0IGdldENhcnRTUUwgPSAnU0VMRUNUICogRlJPTSBfY2FydCBpbm5lciBqb2luIF9jYXJ0X3Byb2R1Y3Qgb24gX2NhcnRfcHJvZHVjdC5jYXJ0X2lkID0gX2NhcnQuY2FydF9pZCB3aGVyZSB1c2VyX2lkID0gPyc7XG4gICAgICB2YXIgY2FydE1vZGVsID0gbmV3IENhcnRNb2RlbChyZXEuYm9keSwgbmV4dCwgdG9rZW4sIGdldENhcnRTUUwpO1xuICAgICAgdmFyIHJlc3VsdCA9IGF3YWl0IGNhcnRNb2RlbC5nZXRDYXJ0KCk7XG4gICAgICBjb25zb2xlLmxvZyhcIlJFU1VMVFwiLCByZXN1bHQpO1xuICAgICAgLy8gd2lsbCByZXR1cm4gYSBzdWNjZXNzIHZhbHVlIGFuZCBkYXRhIGlmIHN1Y2Nlc3MgPT0gdHJ1ZVxuICAgICAgcmVzLmpzb24ocmVzdWx0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGNyZWF0ZUNhcnRTUUwgPSAnaW5zZXJ0IGludG8gX2NhcnQgU0VUIHVzZXJfaWQ9Pyc7XG4gICAgICB2YXIgQ3JlYXRlQ2FydE1vZGVsID0gbmV3IENhcnRNb2RlbChyZXEuYm9keSwgbmV4dCwgdG9rZW4sIGNyZWF0ZUNhcnRTUUwpO1xuICAgICAgY29uc3QgY3JlYXRlZENhcnQgPSBhd2FpdCBDcmVhdGVDYXJ0TW9kZWwuY3JlYXRlQ2FydCgpO1xuICAgICAgcmVzLmpzb24oe1wic3VjY2Vzc1wiOiBmYWxzZX0pO1xuICAgIH1cbiAgfSBjYXRjaChlKSB7XG4gICAgY29uc29sZS5sb2coZSk7XG4gIH1cblxufSk7XG5cbnJvdXRlci5wb3N0KFwiL2FkZFRvQ2FydFwiLCBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgdHJ5IHtcbiAgICAvLyBjaGVjayBpZiBwcm9kdWN0IGlzIGFscmVhZHkgaW4gY2FydCAtIGlmIHNvIHVwZGF0ZSBpdCAtIGVsc2UgYWRkIGl0XG5cbiAgICBjb25zdCBjaGVja1NRTCA9IFwiU0VMRUNUICogRlJPTSBfY2FydF9wcm9kdWN0IHdoZXJlIGNhcnRfaWQgPSA/IEFORCBwcm9kdWN0X2lkID0gP1wiO1xuICAgIGNvbnN0IHRva2VuID0gcmVxLmdldCgnQXV0aG9yaXphdGlvbicpIHx8IFwiXCI7XG4gICAgY29uc3QgQ2hlY2tDYXJ0TW9kZWwgPSBuZXcgQ2FydE1vZGVsKHJlcS5ib2R5LCBuZXh0LCB0b2tlbiwgY2hlY2tTUUwpO1xuICAgIGNvbnN0IGNoZWNrID0gYXdhaXQgQ2hlY2tDYXJ0TW9kZWwuY2hlY2tDYXJ0UHJvZHVjdCgpO1xuICAgIHZhciByZXN1bHQgPSBudWxsO1xuXG4gICAgaWYgKGNoZWNrLmxlbmd0aCA+IDApIHtcbiAgICAgIC8vIHVwZGF0ZSBjYXJ0XG4gICAgICBjb25zdCBhZGRTUUwgPSBcIlVQREFURSBfY2FydF9wcm9kdWN0IFNFVCBxdWFudGl0eSA9ID8gd2hlcmUgY2FydF9pZCA9ID8gQU5EIHByb2R1Y3RfaWQgPSA/XCI7XG4gICAgICB2YXIgVXBkYXRlQ2FydE1vZGVsID0gbmV3IENhcnRNb2RlbChyZXEuYm9keSwgbmV4dCwgdG9rZW4sIGFkZFNRTCk7XG4gICAgICByZXN1bHQgPSBhd2FpdCBVcGRhdGVDYXJ0TW9kZWwudXBkYXRlQ2FydFByb2R1Y3QoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgYWRkU1FMID0gXCJJTlNFUlQgSU5UTyBfY2FydF9wcm9kdWN0IFNFVCA/XCI7XG4gICAgICB2YXIgQWRkQ2FydE1vZGVsID0gbmV3IENhcnRNb2RlbChyZXEuYm9keSwgbmV4dCwgdG9rZW4sIGFkZFNRTCk7XG4gICAgICByZXN1bHQgPSBhd2FpdCBBZGRDYXJ0TW9kZWwuYWRkVG9DYXJ0KCk7XG4gICAgfVxuXG4gICAgcmVzLmpzb24ocmVzdWx0KTtcbiAgfSBjYXRjaChlKSB7XG4gICAgY29uc29sZS5sb2coZSk7XG4gIH1cbn0pO1xuXG5yb3V0ZXIucG9zdChcIi9kZWxldGVGcm9tQ2FydFwiLCBhc3luYyAocmVxLHJlcyxuZXh0KSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgU1FMID0gXCJERUxFVEUgRlJPTSBfY2FydF9wcm9kdWN0IHdoZXJlIGNhcnRfaWQgPSA/IEFORCBwcm9kdWN0X2lkID0gP1wiO1xuICAgIGNvbnN0IHRva2VuID0gcmVxLmdldCgnQXV0aG9yaXphdGlvbicpIHx8IFwiXCI7XG4gICAgY29uc3QgTW9kZWwgPSBuZXcgQ2FydE1vZGVsKHJlcS5ib2R5LCBuZXh0LCB0b2tlbiwgU1FMKTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBNb2RlbC5kZWxldGVGcm9tQ2FydCgpO1xuICAgIHJlcy5qc29uKHJlc3VsdCk7XG4gIH0gY2F0Y2goZSkge1xuICAgIGNvbnNvbGUubG9nKGUpO1xuICB9XG59KTtcblxubW9kdWxlLmV4cG9ydHMgPSByb3V0ZXI7XG4iXX0=

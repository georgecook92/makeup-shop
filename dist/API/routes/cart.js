"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(o,a){try{var c=t[o](a),u=c.value}catch(e){return void r(e)}return c.done?void e(u):Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}var _cartModel=require("../model/cartModel.js"),_cartModel2=_interopRequireDefault(_cartModel),express=require("express"),router=express.Router();router.get("/getCart",function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var o,a,c,u,s,i,d,l,_,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o="SELECT * FROM _cart where user_id = ?",a=t.get("Authorization")||"",c=new _cartModel2.default(t.body,n,a,o),e.next=6,c.checkCartExist();case 6:if(u=e.sent,console.log("cart exist",u),!u.success){e.next=17;break}return s="SELECT * FROM _cart inner join _cart_product on _cart_product.cart_id = _cart.cart_id where user_id = ?",i=new _cartModel2.default(t.body,n,a,s),e.next=13,i.getCart();case 13:d=e.sent,r.json(d),e.next=23;break;case 17:return l="insert into _cart SET user_id=?",_=new _cartModel2.default(t.body,n,a,l),e.next=21,_.createCart();case 21:p=e.sent,r.json({success:!1});case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(0),console.log(e.t0);case 28:case"end":return e.stop()}},e,void 0,[[0,25]])}));return function(t,r,n){return e.apply(this,arguments)}}()),router.post("/addToCart",function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r,n){var o,a,c,u,s,i,d,l,_;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o="SELECT * FROM _cart_product where cart_id = ? AND product_id = ?",a=t.get("Authorization")||"",c=new _cartModel2.default(t.body,n,a,o),e.next=6,c.checkCartProduct();case 6:if(u=e.sent,s=null,!(u.length>0)){e.next=17;break}return i="UPDATE _cart_product SET quantity = quantity + 1 where cart_id = ? AND product_id = ?",d=new _cartModel2.default(t.body,n,a,i),e.next=13,d.updateCartProduct();case 13:s=e.sent,console.log("UPDATE"),e.next=23;break;case 17:return l="INSERT INTO _cart_product SET ?",_=new _cartModel2.default(t.body,n,a,l),e.next=21,_.addToCart();case 21:s=e.sent,console.log("INSERT");case 23:r.json(s),e.next=29;break;case 26:e.prev=26,e.t0=e.catch(0),console.log(e.t0);case 29:case"end":return e.stop()}},e,void 0,[[0,26]])}));return function(t,r,n){return e.apply(this,arguments)}}()),module.exports=router;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJvdXRlcy9jYXJ0LmpzIl0sIm5hbWVzIjpbIl9jYXJ0TW9kZWwiLCJyZXF1aXJlIiwiZXhwcmVzcyIsInJvdXRlciIsIlJvdXRlciIsImdldCIsIl9yZWYiLCJfYXN5bmNUb0dlbmVyYXRvciIsInJlZ2VuZXJhdG9yUnVudGltZSIsIm1hcmsiLCJfY2FsbGVlIiwicmVxIiwicmVzIiwibmV4dCIsImVtYWlsQ2hlY2tTUUwiLCJ0b2tlbiIsIk1vZGVsIiwiY2FydEV4aXN0IiwiZ2V0Q2FydFNRTCIsImNhcnRNb2RlbCIsInJlc3VsdCIsImNyZWF0ZUNhcnRTUUwiLCJDcmVhdGVDYXJ0TW9kZWwiLCJjcmVhdGVkQ2FydCIsIndyYXAiLCJfY29udGV4dCIsInByZXYiLCJfY2FydE1vZGVsMiIsImRlZmF1bHQiLCJib2R5IiwiY2hlY2tDYXJ0RXhpc3QiLCJzZW50Iiwic3VjY2VzcyIsImdldENhcnQiLCJqc29uIiwiY3JlYXRlQ2FydCIsInQwIiwiY29uc29sZSIsImxvZyIsInN0b3AiLCJ1bmRlZmluZWQiLCJfeCIsIl94MiIsIl94MyIsImFwcGx5IiwidGhpcyIsImFyZ3VtZW50cyIsInBvc3QiLCJfcmVmMiIsIl9jYWxsZWUyIiwiY2hlY2tTUUwiLCJDaGVja0NhcnRNb2RlbCIsImNoZWNrIiwiYWRkU1FMIiwiVXBkYXRlQ2FydE1vZGVsIiwiX2FkZFNRTCIsIkFkZENhcnRNb2RlbCIsIl9jb250ZXh0MiIsImNoZWNrQ2FydFByb2R1Y3QiLCJsZW5ndGgiLCJ1cGRhdGVDYXJ0UHJvZHVjdCIsImFkZFRvQ2FydCIsIl94NCIsIl94NSIsIl94NiIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJrWUFFQSxHQUFBQSxZQUFBQyxRQUFBLHdFQUZJQyxRQUFVRCxRQUFRLFdBQ2xCRSxPQUFTRCxRQUFRRSxRQUdyQkQsUUFBT0UsSUFBSSxXQUFYLFdBQUEsR0FBQUMsR0FBQUMsa0JBQUFDLG1CQUFBQyxLQUF1QixRQUFBQyxHQUFPQyxFQUFLQyxFQUFL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LEtBb0JwQk0sUUFBUUMsSUFBSSxTQXBCUSxLQUFBLElBVmhCaEIsRUFBQUEsS0FBQUEsR0FVZ0JtQyxFQUFBNUMsS0FBQSxFQUFBLE1BQUEsS0FBQSxJQUFBNEMsRUFBQS9CLEtBQUEsR0FBQStCLEVBQUFyQixHQUFBcUIsRUFBQSxNQUFBLEdBMUJIcEIsUUFBQUMsSUFBQW1CLEVBQUFyQixHQTBCRyxLQUFBLElBQUEsSUFBQSxNQUFBLE1BQUFxQixHQUFBbEIsU0FBQVUsRUFBQVQsU0FBQSxFQUFBLFFBQTFCLE9BQUEsVUFBQXNCLEVBQUFDLEVBQUFDLEdBQUEsTUFBQWhCLEdBQUFKLE1BQUFDLEtBQUFDLGdCQTZCQW1CLE9BQU9DLFFBQVUvRCIsImZpbGUiOiJyb3V0ZXMvY2FydC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xudmFyIHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5pbXBvcnQgQ2FydE1vZGVsIGZyb20gJy4uL21vZGVsL2NhcnRNb2RlbC5qcyc7XG5cbnJvdXRlci5nZXQoJy9nZXRDYXJ0JywgYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgZW1haWxDaGVja1NRTCA9ICdTRUxFQ1QgKiBGUk9NIF9jYXJ0IHdoZXJlIHVzZXJfaWQgPSA/JztcbiAgICBjb25zdCB0b2tlbiA9IHJlcS5nZXQoJ0F1dGhvcml6YXRpb24nKSB8fCBcIlwiO1xuICAgIGNvbnN0IE1vZGVsID0gbmV3IENhcnRNb2RlbChyZXEuYm9keSwgbmV4dCwgdG9rZW4sIGVtYWlsQ2hlY2tTUUwpO1xuICAgIGNvbnN0IGNhcnRFeGlzdCA9IGF3YWl0IE1vZGVsLmNoZWNrQ2FydEV4aXN0KCk7XG4gICAgY29uc29sZS5sb2coXCJjYXJ0IGV4aXN0XCIsIGNhcnRFeGlzdCk7XG5cbiAgICBpZiAoY2FydEV4aXN0LnN1Y2Nlc3MpIHtcbiAgICAgIGNvbnN0IGdldENhcnRTUUwgPSAnU0VMRUNUICogRlJPTSBfY2FydCBpbm5lciBqb2luIF9jYXJ0X3Byb2R1Y3Qgb24gX2NhcnRfcHJvZHVjdC5jYXJ0X2lkID0gX2NhcnQuY2FydF9pZCB3aGVyZSB1c2VyX2lkID0gPyc7XG4gICAgICB2YXIgY2FydE1vZGVsID0gbmV3IENhcnRNb2RlbChyZXEuYm9keSwgbmV4dCwgdG9rZW4sIGdldENhcnRTUUwpO1xuICAgICAgdmFyIHJlc3VsdCA9IGF3YWl0IGNhcnRNb2RlbC5nZXRDYXJ0KCk7XG4gICAgICAvLyB3aWxsIHJldHVybiBhIHN1Y2Nlc3MgdmFsdWUgYW5kIGRhdGEgaWYgc3VjY2VzcyA9PSB0cnVlXG4gICAgICByZXMuanNvbihyZXN1bHQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgY3JlYXRlQ2FydFNRTCA9ICdpbnNlcnQgaW50byBfY2FydCBTRVQgdXNlcl9pZD0/JztcbiAgICAgIHZhciBDcmVhdGVDYXJ0TW9kZWwgPSBuZXcgQ2FydE1vZGVsKHJlcS5ib2R5LCBuZXh0LCB0b2tlbiwgY3JlYXRlQ2FydFNRTCk7XG4gICAgICBjb25zdCBjcmVhdGVkQ2FydCA9IGF3YWl0IENyZWF0ZUNhcnRNb2RlbC5jcmVhdGVDYXJ0KCk7XG4gICAgICByZXMuanNvbih7XCJzdWNjZXNzXCI6IGZhbHNlfSk7XG4gICAgfVxuICB9IGNhdGNoKGUpIHtcbiAgICBjb25zb2xlLmxvZyhlKTtcbiAgfVxuXG59KTtcblxucm91dGVyLnBvc3QoXCIvYWRkVG9DYXJ0XCIsIGFzeW5jIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICB0cnkge1xuICAgIC8vIGNoZWNrIGlmIHByb2R1Y3QgaXMgYWxyZWFkeSBpbiBjYXJ0IC0gaWYgc28gdXBkYXRlIGl0IC0gZWxzZSBhZGQgaXRcblxuICAgIGNvbnN0IGNoZWNrU1FMID0gXCJTRUxFQ1QgKiBGUk9NIF9jYXJ0X3Byb2R1Y3Qgd2hlcmUgY2FydF9pZCA9ID8gQU5EIHByb2R1Y3RfaWQgPSA/XCI7XG4gICAgY29uc3QgdG9rZW4gPSByZXEuZ2V0KCdBdXRob3JpemF0aW9uJykgfHwgXCJcIjtcbiAgICBjb25zdCBDaGVja0NhcnRNb2RlbCA9IG5ldyBDYXJ0TW9kZWwocmVxLmJvZHksIG5leHQsIHRva2VuLCBjaGVja1NRTCk7XG4gICAgY29uc3QgY2hlY2sgPSBhd2FpdCBDaGVja0NhcnRNb2RlbC5jaGVja0NhcnRQcm9kdWN0KCk7XG4gICAgdmFyIHJlc3VsdCA9IG51bGw7XG5cbiAgICBpZiAoY2hlY2subGVuZ3RoID4gMCkge1xuICAgICAgLy8gdXBkYXRlIGNhcnRcbiAgICAgIGNvbnN0IGFkZFNRTCA9IFwiVVBEQVRFIF9jYXJ0X3Byb2R1Y3QgU0VUIHF1YW50aXR5ID0gcXVhbnRpdHkgKyAxIHdoZXJlIGNhcnRfaWQgPSA/IEFORCBwcm9kdWN0X2lkID0gP1wiO1xuICAgICAgdmFyIFVwZGF0ZUNhcnRNb2RlbCA9IG5ldyBDYXJ0TW9kZWwocmVxLmJvZHksIG5leHQsIHRva2VuLCBhZGRTUUwpO1xuICAgICAgcmVzdWx0ID0gYXdhaXQgVXBkYXRlQ2FydE1vZGVsLnVwZGF0ZUNhcnRQcm9kdWN0KCk7XG4gICAgICBjb25zb2xlLmxvZyhcIlVQREFURVwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgYWRkU1FMID0gXCJJTlNFUlQgSU5UTyBfY2FydF9wcm9kdWN0IFNFVCA/XCI7XG4gICAgICB2YXIgQWRkQ2FydE1vZGVsID0gbmV3IENhcnRNb2RlbChyZXEuYm9keSwgbmV4dCwgdG9rZW4sIGFkZFNRTCk7XG4gICAgICByZXN1bHQgPSBhd2FpdCBBZGRDYXJ0TW9kZWwuYWRkVG9DYXJ0KCk7XG4gICAgICBjb25zb2xlLmxvZyhcIklOU0VSVFwiKTtcbiAgICB9XG5cbiAgICByZXMuanNvbihyZXN1bHQpO1xuICB9IGNhdGNoKGUpIHtcbiAgICBjb25zb2xlLmxvZyhlKTtcbiAgfVxufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gcm91dGVyO1xuIl19

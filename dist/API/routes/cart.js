"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _asyncToGenerator(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,r){function n(o,c){try{var a=e[o](c),u=a.value}catch(t){return void r(t)}return a.done?void t(u):Promise.resolve(u).then(function(t){n("next",t)},function(t){n("throw",t)})}return n("next")})}}var _cartModel=require("../model/cartModel.js"),_cartModel2=_interopRequireDefault(_cartModel),express=require("express"),router=express.Router();router.get("/getCart",function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(e,r,n){var o,c,a,u,d,i,_,s,p,l;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o="SELECT * FROM _cart where user_id = ?",c=e.get("Authorization")||"test",a=new _cartModel2.default(e.body,n,c,o),t.next=6,a.checkCartExist();case 6:if(u=t.sent,0===u.length){t.next=16;break}return d="SELECT _product.product_id, _product.product_name, _product.price, _cart_product.quantity, _product.discount  FROM _cart inner join _cart_product on _cart_product.cart_id = _cart.cart_id inner join _product on _product.product_id = _cart_product.product_id where user_id = ?",i=new _cartModel2.default(e.body,n,c,d),t.next=12,i.getCart();case 12:_=t.sent,r.json({data:_,cartId:u[0].cart_id}),t.next=22;break;case 16:return s="insert into _cart SET user_id=?",p=new _cartModel2.default(e.body,n,c,s),t.next=20,p.createCart();case 20:l=t.sent,r.json([]);case 22:t.next=27;break;case 24:t.prev=24,t.t0=t.catch(0),console.log(t.t0);case 27:case"end":return t.stop()}},t,void 0,[[0,24]])}));return function(e,r,n){return t.apply(this,arguments)}}()),router.post("/addToCart",function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(e,r,n){var o,c,a,u,d,i,_,s,p,l,f,h,x,v,y,w;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o="SELECT * FROM _cart_product where cart_id = ? AND product_id = ?",c=e.get("Authorization")||"",a=new _cartModel2.default(e.body,n,c,o),t.next=6,a.checkCartProduct();case 6:if(u=t.sent,console.log("check",u),d=void 0,!(u.length>0)){t.next=20;break}return i=u[0].quantity+e.body.quantity,console.log("body",e.body),console.log("Q",i),_="UPDATE _cart_product SET quantity = "+i+" where cart_id = ? AND product_id = ?",s=new _cartModel2.default(e.body,n,c,_),t.next=17,s.updateCartProduct();case 17:d=t.sent,t.next=25;break;case 20:return p="INSERT INTO _cart_product SET ?",l=new _cartModel2.default(e.body,n,c,p),t.next=24,l.addToCart();case 24:d=t.sent;case 25:return f="SELECT * FROM _cart where user_id = ?",h=new _cartModel2.default(e.body,n,c,f),t.next=29,h.checkCartExist();case 29:return x=t.sent,v="SELECT _product.product_id, _product.product_name, _product.price, _cart_product.quantity, _product.discount  FROM _cart inner join _cart_product on _cart_product.cart_id = _cart.cart_id inner join _product on _product.product_id = _cart_product.product_id where user_id = ?",y=new _cartModel2.default(e.body,n,c,v),t.next=34,y.getCart();case 34:w=t.sent,r.json({data:w,cartId:x[0].cart_id}),t.next=41;break;case 38:t.prev=38,t.t0=t.catch(0),console.log(t.t0);case 41:case"end":return t.stop()}},t,void 0,[[0,38]])}));return function(e,r,n){return t.apply(this,arguments)}}()),router.post("/deleteFromCart",function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function t(e,r,n){var o,c,a,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o="DELETE FROM _cart_product where cart_id = ? AND product_id = ?",c=e.get("Authorization")||"",a=new _cartModel2.default(e.body,n,c,o),t.next=6,a.deleteFromCart();case 6:u=t.sent,r.json(u),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),console.log(t.t0);case 13:case"end":return t.stop()}},t,void 0,[[0,10]])}));return function(e,r,n){return t.apply(this,arguments)}}()),module.exports=router;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJvdXRlcy9jYXJ0LmpzIl0sIm5hbWVzIjpbIl9jYXJ0TW9kZWwiLCJyZXF1aXJlIiwiZXhwcmVzcyIsInJvdXRlciIsIlJvdXRlciIsImdldCIsIl9yZWYiLCJfYXN5bmNUb0dlbmVyYXRvciIsInJlZ2VuZXJhdG9yUnVudGltZSIsIm1hcmsiLCJfY2FsbGVlIiwicmVxIiwicmVzIiwibmV4dCIsImVtYWlsQ2hlY2tTUUwiLCJ0b2tlbiIsIk1vZGVsIiwiY2FydEV4aXN0IiwiZ2V0Q2FydFNRTCIsImNhcnRNb2RlbCIsInJlc3VsdCIsImNyZWF0ZUNhcnRTUUwiLCJDcmVhdGVDYXJ0TW9kZWwiLCJjcmVhdGVkQ2FydCIsIndyYXAiLCJfY29udGV4dCIsInByZXYiLCJfY2FydE1vZGVsMiIsImRlZmF1bHQiLCJib2R5IiwiY2hlY2tDYXJ0RXhpc3QiLCJzZW50IiwiZ2V0Q2FydCIsImpzb24iLCJkYXRhIiwiY2FydElkIiwiY2FydF9pZCIsImNyZWF0ZUNhcnQiLCJ0MCIsInN0b3AiLCJ1bmRlZmluZWQiLCJfeCIsIl94MiIsIl94MyIsImFwcGx5IiwidGhpcyIsImFyZ3VtZW50cyIsIl9jYWxsZWUyIiwiY2hlY2tTUUwiLCJDaGVja0NhcnRNb2RlbCIsImNoZWNrIiwicXVhbnRpdHkiLCJhZGRTUUwiLCJVcGRhdGVDYXJ0TW9kZWwiLCJfYWRkU1FMIiwiQWRkQ2FydE1vZGVsIiwiY2FydENoZWNrU1FMIiwiX2NvbnRleHQyIiwiY2hlY2tDYXJ0UHJvZHVjdCIsImxlbmd0aCIsImNvbnNvbGUiLCJsb2ciLCJ1cGRhdGVDYXJ0UHJvZHVjdCIsImFkZFRvQ2FydCIsInBvc3QiLCJfcmVmMyIsIl9jYWxsZWUzIiwiU1FMIiwiX2NvbnRleHQzIiwiZGVsZXRlRnJvbUNhcnQiLCJfeDciLCJfeDgiLCJfeDkiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoia1lBRUEsR0FBQUEsWUFBQUMsUUFBQSx3RUFGSUMsUUFBVUQsUUFBUSxXQUNsQkUsT0FBU0Qs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LEVBQUFDLEVBQUFDLEdBQUEsR0FBQXNELEdBQUFwRCxFQUFBQyxFQUFBSSxDQUFBLE9BQUFaLG9CQUFBZ0IsS0FBQSxTQUFBNEMsR0FBQSxPQUFBLE9BQUFBLEVBQUExQyxLQUFBMEMsRUFBQXZELE1BQUEsSUFBQSxHQUFBLE1BQUF1RCxHQUFBMUMsS0FBQSxFQW9CbkJrQyxFQUFBQSxpRUE2Q003QyxFQUFRSixFQUFJTixJQUFJLGtCQUFvQixHQWpFdkJXLEVBQUEsR0FBQVcsYUFBQUMsUUFBQWpCLEVBQUFrQixLQUFBaEIsRUFBQUUsRUFBQW9ELEdBQUFDLEVBQUF2RCxLQUFBLEVBQUFHLEVBQUFxRCxnQkFBQSxLQUFBLEdBQUFqRCxFQUFBZ0QsRUFBQXJDLEtBQUFuQixFQUFBcUIsS0FBQWIsR0FBQWdELEVBQUF2RCxLQUFBLEVBQUEsTUFBQSxLQUFBLElBQUF1RCxFQUFBMUMsS0FBQSxHQUFBMEMsRUFBQTlCLEdBQUE4QixFQUFBLE1BQUEsR0FBQVIsUUFBQUMsSUFBQU8sRUFBQTlCLEdBQUEsS0FBQSxJQUFBLElBQUEsTUFBQSxNQUFBOEIsR0FBQTdCLFNBQUEyQixFQUFBMUIsU0FBQSxFQUFBLFFBQUEsT0FBQSxVQUFBOEIsRUFBQUMsRUFBQUMsR0FBQSxNQUFBUCxHQUFBckIsTUFBQUMsS0FBQUMsZ0JBQXZCMkIsT0FBQUMsUUFBQXZFIiwiZmlsZSI6InJvdXRlcy9jYXJ0LmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7XG52YXIgcm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcbmltcG9ydCBDYXJ0TW9kZWwgZnJvbSAnLi4vbW9kZWwvY2FydE1vZGVsLmpzJztcblxucm91dGVyLmdldCgnL2dldENhcnQnLCBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBlbWFpbENoZWNrU1FMID0gJ1NFTEVDVCAqIEZST00gX2NhcnQgd2hlcmUgdXNlcl9pZCA9ID8nO1xuICAgIGNvbnN0IHRva2VuID0gcmVxLmdldCgnQXV0aG9yaXphdGlvbicpIHx8IFwidGVzdFwiO1xuICAgIGNvbnN0IE1vZGVsID0gbmV3IENhcnRNb2RlbChyZXEuYm9keSwgbmV4dCwgdG9rZW4sIGVtYWlsQ2hlY2tTUUwpO1xuICAgIGNvbnN0IGNhcnRFeGlzdCA9IGF3YWl0IE1vZGVsLmNoZWNrQ2FydEV4aXN0KCk7XG5cbiAgICBpZiAoY2FydEV4aXN0Lmxlbmd0aCAhPT0gMCkge1xuICAgICAgY29uc3QgZ2V0Q2FydFNRTCA9ICdTRUxFQ1QgX3Byb2R1Y3QucHJvZHVjdF9pZCwgX3Byb2R1Y3QucHJvZHVjdF9uYW1lLCBfcHJvZHVjdC5wcmljZSwgX2NhcnRfcHJvZHVjdC5xdWFudGl0eSwgX3Byb2R1Y3QuZGlzY291bnQgIEZST00gX2NhcnQgaW5uZXIgam9pbiBfY2FydF9wcm9kdWN0IG9uIF9jYXJ0X3Byb2R1Y3QuY2FydF9pZCA9IF9jYXJ0LmNhcnRfaWQgaW5uZXIgam9pbiBfcHJvZHVjdCBvbiBfcHJvZHVjdC5wcm9kdWN0X2lkID0gX2NhcnRfcHJvZHVjdC5wcm9kdWN0X2lkIHdoZXJlIHVzZXJfaWQgPSA/JztcbiAgICAgIHZhciBjYXJ0TW9kZWwgPSBuZXcgQ2FydE1vZGVsKHJlcS5ib2R5LCBuZXh0LCB0b2tlbiwgZ2V0Q2FydFNRTCk7XG4gICAgICB2YXIgcmVzdWx0ID0gYXdhaXQgY2FydE1vZGVsLmdldENhcnQoKTtcbiAgICAgIC8vIHdpbGwgcmV0dXJuIGEgc3VjY2VzcyB2YWx1ZSBhbmQgZGF0YSBpZiBzdWNjZXNzID09IHRydWVcbiAgICAgIHJlcy5qc29uKHtkYXRhOiByZXN1bHQsIGNhcnRJZDogY2FydEV4aXN0WzBdLmNhcnRfaWR9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGNyZWF0ZUNhcnRTUUwgPSAnaW5zZXJ0IGludG8gX2NhcnQgU0VUIHVzZXJfaWQ9Pyc7XG4gICAgICB2YXIgQ3JlYXRlQ2FydE1vZGVsID0gbmV3IENhcnRNb2RlbChyZXEuYm9keSwgbmV4dCwgdG9rZW4sIGNyZWF0ZUNhcnRTUUwpO1xuICAgICAgY29uc3QgY3JlYXRlZENhcnQgPSBhd2FpdCBDcmVhdGVDYXJ0TW9kZWwuY3JlYXRlQ2FydCgpO1xuICAgICAgcmVzLmpzb24oW10pO1xuICAgIH1cbiAgfSBjYXRjaChlKSB7XG4gICAgY29uc29sZS5sb2coZSk7XG4gIH1cblxufSk7XG5cbnJvdXRlci5wb3N0KFwiL2FkZFRvQ2FydFwiLCBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgdHJ5IHtcbiAgICAvLyBjaGVjayBpZiBwcm9kdWN0IGlzIGFscmVhZHkgaW4gY2FydCAtIGlmIHNvIHVwZGF0ZSBpdCAtIGVsc2UgYWRkIGl0XG5cbiAgICBjb25zdCBjaGVja1NRTCA9IFwiU0VMRUNUICogRlJPTSBfY2FydF9wcm9kdWN0IHdoZXJlIGNhcnRfaWQgPSA/IEFORCBwcm9kdWN0X2lkID0gP1wiO1xuICAgIGNvbnN0IHRva2VuID0gcmVxLmdldCgnQXV0aG9yaXphdGlvbicpIHx8IFwiXCI7XG4gICAgY29uc3QgQ2hlY2tDYXJ0TW9kZWwgPSBuZXcgQ2FydE1vZGVsKHJlcS5ib2R5LCBuZXh0LCB0b2tlbiwgY2hlY2tTUUwpO1xuICAgIGNvbnN0IGNoZWNrID0gYXdhaXQgQ2hlY2tDYXJ0TW9kZWwuY2hlY2tDYXJ0UHJvZHVjdCgpO1xuICAgIGNvbnNvbGUubG9nKCdjaGVjaycsIGNoZWNrKTtcbiAgICBsZXQgcmVzdWx0O1xuXG4gICAgaWYgKGNoZWNrLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHF1YW50aXR5ID0gY2hlY2tbMF0ucXVhbnRpdHkgKyByZXEuYm9keS5xdWFudGl0eTtcbiAgICAgIGNvbnNvbGUubG9nKCdib2R5JywgcmVxLmJvZHkpO1xuICAgICAgY29uc29sZS5sb2coXCJRXCIsIHF1YW50aXR5KTtcbiAgICAgIC8vIHVwZGF0ZSBjYXJ0XG4gICAgICBjb25zdCBhZGRTUUwgPSBcIlVQREFURSBfY2FydF9wcm9kdWN0IFNFVCBxdWFudGl0eSA9IFwiICsgcXVhbnRpdHkgKyBcIiB3aGVyZSBjYXJ0X2lkID0gPyBBTkQgcHJvZHVjdF9pZCA9ID9cIjtcbiAgICAgIHZhciBVcGRhdGVDYXJ0TW9kZWwgPSBuZXcgQ2FydE1vZGVsKHJlcS5ib2R5LCBuZXh0LCB0b2tlbiwgYWRkU1FMKTtcbiAgICAgIHJlc3VsdCA9IGF3YWl0IFVwZGF0ZUNhcnRNb2RlbC51cGRhdGVDYXJ0UHJvZHVjdCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBhZGRTUUwgPSBcIklOU0VSVCBJTlRPIF9jYXJ0X3Byb2R1Y3QgU0VUID9cIjtcbiAgICAgIHZhciBBZGRDYXJ0TW9kZWwgPSBuZXcgQ2FydE1vZGVsKHJlcS5ib2R5LCBuZXh0LCB0b2tlbiwgYWRkU1FMKTtcbiAgICAgIHJlc3VsdCA9IGF3YWl0IEFkZENhcnRNb2RlbC5hZGRUb0NhcnQoKTtcbiAgICB9XG5cbiAgICBjb25zdCBjYXJ0Q2hlY2tTUUwgPSAnU0VMRUNUICogRlJPTSBfY2FydCB3aGVyZSB1c2VyX2lkID0gPyc7XG4gICAgY29uc3QgTW9kZWwgPSBuZXcgQ2FydE1vZGVsKHJlcS5ib2R5LCBuZXh0LCB0b2tlbiwgY2FydENoZWNrU1FMKTtcbiAgICBjb25zdCBjYXJ0RXhpc3QgPSBhd2FpdCBNb2RlbC5jaGVja0NhcnRFeGlzdCgpO1xuICAgIGNvbnN0IGdldENhcnRTUUwgPSAnU0VMRUNUIF9wcm9kdWN0LnByb2R1Y3RfaWQsIF9wcm9kdWN0LnByb2R1Y3RfbmFtZSwgX3Byb2R1Y3QucHJpY2UsIF9jYXJ0X3Byb2R1Y3QucXVhbnRpdHksIF9wcm9kdWN0LmRpc2NvdW50ICBGUk9NIF9jYXJ0IGlubmVyIGpvaW4gX2NhcnRfcHJvZHVjdCBvbiBfY2FydF9wcm9kdWN0LmNhcnRfaWQgPSBfY2FydC5jYXJ0X2lkIGlubmVyIGpvaW4gX3Byb2R1Y3Qgb24gX3Byb2R1Y3QucHJvZHVjdF9pZCA9IF9jYXJ0X3Byb2R1Y3QucHJvZHVjdF9pZCB3aGVyZSB1c2VyX2lkID0gPyc7XG4gICAgdmFyIGNhcnRNb2RlbCA9IG5ldyBDYXJ0TW9kZWwocmVxLmJvZHksIG5leHQsIHRva2VuLCBnZXRDYXJ0U1FMKTtcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgY2FydE1vZGVsLmdldENhcnQoKTtcbiAgICByZXMuanNvbih7ZGF0YTogZGF0YSwgY2FydElkOiBjYXJ0RXhpc3RbMF0uY2FydF9pZH0pO1xuICB9IGNhdGNoKGUpIHtcbiAgICBjb25zb2xlLmxvZyhlKTtcbiAgfVxufSk7XG5cbnJvdXRlci5wb3N0KFwiL2RlbGV0ZUZyb21DYXJ0XCIsIGFzeW5jIChyZXEscmVzLG5leHQpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBTUUwgPSBcIkRFTEVURSBGUk9NIF9jYXJ0X3Byb2R1Y3Qgd2hlcmUgY2FydF9pZCA9ID8gQU5EIHByb2R1Y3RfaWQgPSA/XCI7XG4gICAgY29uc3QgdG9rZW4gPSByZXEuZ2V0KCdBdXRob3JpemF0aW9uJykgfHwgXCJcIjtcbiAgICBjb25zdCBNb2RlbCA9IG5ldyBDYXJ0TW9kZWwocmVxLmJvZHksIG5leHQsIHRva2VuLCBTUUwpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IE1vZGVsLmRlbGV0ZUZyb21DYXJ0KCk7XG4gICAgcmVzLmpzb24ocmVzdWx0KTtcbiAgfSBjYXRjaChlKSB7XG4gICAgY29uc29sZS5sb2coZSk7XG4gIH1cbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjtcbiJdfQ==

"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _authModel=require("../model/authModel.js"),_authModel2=_interopRequireDefault(_authModel),express=require("express"),router=express.Router(),RateLimit=require("express-rate-limit"),createAccountLimiter=new RateLimit({windowMs:6e4,delayAfter:5,delayMs:3e3,max:10,message:"Too many attempts from this IP, please try again in three minutes",handler:function(e,t){t.json({error:"Too many attempts from this IP, please try again in three minutes"})}});router.post("/login",createAccountLimiter,function(e,t,r){var o="select * from `_users` where `email` = ?",s=new _authModel2.default(e.body,t,r,o);s.login()}),router.post("/register",function(e,t,r){var o="select * from `_users` where `email` = ?",s=new _authModel2.default(e.body,t,r,o);s.register()}),router.post("/confirmUser",function(e,t,r){var o="update _users set `verified` = 1, `token` = NULL where `token` = ?",s=new _authModel2.default(e.body,t,r,o);s.confirmUser()}),router.post("/changePassword",function(e,t,r){var o="update _users set `password` = ? where `user_id` = ?",s=new _authModel2.default(e.body,t,r,o);s.changePassword()}),router.post("/forgotPassword",function(e,t,r){var o="update _users set `token` = ? where `email` = ?",s=new _authModel2.default(e.body,t,r,o);s.forgotPasswordSetup()}),module.exports=router;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJvdXRlcy9hdXRoLmpzIl0sIm5hbWVzIjpbIl9hdXRoTW9kZWwiLCJyZXF1aXJlIiwiZXhwcmVzcyIsInJvdXRlciIsIlJvdXRlciIsIlJhdGVMaW1pdCIsImNyZWF0ZUFjY291bnRMaW1pdGVyIiwid2luZG93TXMiLCJkZWxheUFmdGVyIiwiZGVsYXlNcyIsIm1heCIsIm1lc3NhZ2UiLCJoYW5kbGVyIiwicmVzIiwianNvbiIsImVycm9yIiwicG9zdCIsInJlcSIsIm5leHQiLCJlbWFpbENoZWNrU1FMIiwiTW9kZWwiLCJfYXV0aE1vZGVsMiIsImRlZmF1bHQiLCJib2R5IiwibG9naW4iLCJ1cGRhdGVDb25maXJtVXNlclNRTCIsImNoYW5nZVBhc3N3b3JkU1FMIiwiZm9yZ290dGVuUGFzc3dvcmRTUUwiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoicUZBRUEsR0FBQUEsWUFBQUMsUUFBQSx3RUFGSUMsUUFBVUQsUUFBUSxXQUNsQkUsT0FBU0QsUUFBUUUsU0FHakJDLFVBQVlKLFFBQVEsc0JBRXBCSyxxQkFBdUIsR0FBSUQsWUFDN0JFLFNBQVUsSUFQWkMsV0FBY1AsRUFDZFEsUUFBSU4sSUFTRk8sSUFBSyxHQUNMQyxRQUFTLG9FQVBYQyxRQUFJUCxTQUFBQSxFQUFZSixHQVNaWSxFQUFJQyxNQUFNQyxNQUFPLHdFQUNsQlosUUFBQWEsS0FBQSxTQUFBVixxQkFBQSxTQUFBVyxFQUFBSixFQUFBSyxHQVJILEdBQUFDLEdBQUEsMkNBa0JNQyxFQUFRLEdBQUFDLGFBQUFDLFFBQWNMLEVBQUlNLEtBQU1WLEVBQUtLLEVBQU1DLEVBUGpEQyxHQUFBSSxVQUdBckIsT0FBQWEsS0FBQSxZQUFBLFNBQUFDLEVBQUFKLEVBQUFLLEdBU0UsR0FBSUMsR0FBZ0IsMkNBUHRCaEIsRUFBWSxHQUFBa0IsYUFBQUMsUUFBVWhCLEVBQUFBLEtBQUFBLEVBQXRCWSxFQUE0Q0MsRUFDMUNDLEdBQUlELGFBR0xoQixPQUpEYSxLQUFBLGVBQUEsU0FBQUMsRUFBQUosRUFBQUssR0FhRSxHQUFJTyxHQUF1QixxRUFQN0J0QixFQUFZLEdBQUFrQixhQUFBQyxRQUFhTCxFQUFBTSxLQUFBVixFQUFBSyxFQUFBTyxFQUN2QkwsR0FBSUQsZ0JBR0xoQixPQUpEYSxLQUFBLGtCQUFBLFNBQUFDLEVBQUFKLEVBQUFLLEdBYUUsR0FBSVEsR0FBb0IsdURBUDFCdkIsRUFBWSxHQUFBa0IsYUFBQUMsUUFBZ0JMLEVBQUFNLEtBQUNOLEVBQUtKLEVBQUtLLEVBQ3JDRSxHQUFJSyxtQkFHTHRCLE9BSkRhLEtBQUEsa0JBQUEsU0FBQUMsRUFBQUosRUFBQUssR0FhRSxHQUFJUyxHQUF1QixrREFQN0J4QixFQUFZLEdBQUFrQixhQUFBQyxRQUFBTCxFQUFtQk0sS0FBQVYsRUFBQ0ksRUFBRFUsRUFDN0JQLEdBQUlNLHdCQUdMRSxPQUpEQyxRQUFBMUIiLCJmaWxlIjoicm91dGVzL2F1dGguanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbnZhciByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuaW1wb3J0IEF1dGhNb2RlbCBmcm9tICcuLi9tb2RlbC9hdXRoTW9kZWwuanMnO1xuXG52YXIgUmF0ZUxpbWl0ID0gcmVxdWlyZSgnZXhwcmVzcy1yYXRlLWxpbWl0Jyk7XG5cbnZhciBjcmVhdGVBY2NvdW50TGltaXRlciA9IG5ldyBSYXRlTGltaXQoe1xuICB3aW5kb3dNczogMSAqIDYwICogMTAwMCwgLy8gNSBtaW51dGUgd2luZG93XG4gIGRlbGF5QWZ0ZXI6IDUsIC8vIGJlZ2luIHNsb3dpbmcgZG93biByZXNwb25zZXMgYWZ0ZXIgdGhlIGZpcnN0IHJlcXVlc3RcbiAgZGVsYXlNczogMyAqIDEwMDAsIC8vIHNsb3cgZG93biBzdWJzZXF1ZW50IHJlc3BvbnNlcyBieSAzIHNlY29uZHMgcGVyIHJlcXVlc3RcbiAgbWF4OiAxMCwgLy8gc3RhcnQgYmxvY2tpbmcgYWZ0ZXIgNSByZXF1ZXN0c1xuICBtZXNzYWdlOiBcIlRvbyBtYW55IGF0dGVtcHRzIGZyb20gdGhpcyBJUCwgcGxlYXNlIHRyeSBhZ2FpbiBpbiB0aHJlZSBtaW51dGVzXCIsXG4gIGhhbmRsZXI6IChyZXEsIHJlcykgPT4ge1xuICAgIHJlcy5qc29uKHtlcnJvcjogJ1RvbyBtYW55IGF0dGVtcHRzIGZyb20gdGhpcyBJUCwgcGxlYXNlIHRyeSBhZ2FpbiBpbiB0aHJlZSBtaW51dGVzJ30pO1xuICB9XG59KTtcblxuLy8gc2VuZCBlbWFpbCBvdXQgb24gcmVnaXN0cmF0aW9uIC0gc3BhbSBjb250cm9sIC0gQ0hBTkdFIFNFTkQgR1JJRCAqKioqKioqKioqKioqKioqKioqKioqKioqXG5cbi8vIGZvcmdvdCBwYXNzd29yZFxuLy8gY2hhbmdlIHBhc3N3b3JkICh0cnkgYW5kIG1ha2UgdGhpcyB3b3JrIGZvciBib3RoIChpZSBhYm92ZSBhcyB3ZWxsKSlcblxucm91dGVyLnBvc3QoJy9sb2dpbicsIGNyZWF0ZUFjY291bnRMaW1pdGVyLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgdmFyIGVtYWlsQ2hlY2tTUUwgPSAnc2VsZWN0ICogZnJvbSBgX3VzZXJzYCB3aGVyZSBgZW1haWxgID0gPyc7XG4gIHZhciBNb2RlbCA9IG5ldyBBdXRoTW9kZWwocmVxLmJvZHksIHJlcywgbmV4dCwgZW1haWxDaGVja1NRTCk7XG4gIE1vZGVsLmxvZ2luKCk7XG59KTtcblxucm91dGVyLnBvc3QoJy9yZWdpc3RlcicsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICB2YXIgZW1haWxDaGVja1NRTCA9ICdzZWxlY3QgKiBmcm9tIGBfdXNlcnNgIHdoZXJlIGBlbWFpbGAgPSA/JztcbiAgdmFyIE1vZGVsID0gbmV3IEF1dGhNb2RlbChyZXEuYm9keSwgcmVzLCBuZXh0LCBlbWFpbENoZWNrU1FMKTtcbiAgTW9kZWwucmVnaXN0ZXIoKTtcbn0pO1xuXG5yb3V0ZXIucG9zdCgnL2NvbmZpcm1Vc2VyJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIHZhciB1cGRhdGVDb25maXJtVXNlclNRTCA9ICd1cGRhdGUgX3VzZXJzIHNldCBgdmVyaWZpZWRgID0gMSwgYHRva2VuYCA9IE5VTEwgd2hlcmUgYHRva2VuYCA9ID8nO1xuICB2YXIgTW9kZWwgPSBuZXcgQXV0aE1vZGVsKHJlcS5ib2R5LCByZXMsIG5leHQsIHVwZGF0ZUNvbmZpcm1Vc2VyU1FMKTtcbiAgTW9kZWwuY29uZmlybVVzZXIoKTtcbn0pO1xuXG5yb3V0ZXIucG9zdCgnL2NoYW5nZVBhc3N3b3JkJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIHZhciBjaGFuZ2VQYXNzd29yZFNRTCA9ICd1cGRhdGUgX3VzZXJzIHNldCBgcGFzc3dvcmRgID0gPyB3aGVyZSBgdXNlcl9pZGAgPSA/JztcbiAgdmFyIE1vZGVsID0gbmV3IEF1dGhNb2RlbChyZXEuYm9keSwgcmVzLCBuZXh0LCBjaGFuZ2VQYXNzd29yZFNRTCk7XG4gIE1vZGVsLmNoYW5nZVBhc3N3b3JkKCk7XG59KTtcblxucm91dGVyLnBvc3QoJy9mb3Jnb3RQYXNzd29yZCcsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICB2YXIgZm9yZ290dGVuUGFzc3dvcmRTUUwgPSAndXBkYXRlIF91c2VycyBzZXQgYHRva2VuYCA9ID8gd2hlcmUgYGVtYWlsYCA9ID8nO1xuICB2YXIgTW9kZWwgPSBuZXcgQXV0aE1vZGVsKHJlcS5ib2R5LCByZXMsIG5leHQsIGZvcmdvdHRlblBhc3N3b3JkU1FMKTtcbiAgTW9kZWwuZm9yZ290UGFzc3dvcmRTZXR1cCgpO1xufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gcm91dGVyO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9

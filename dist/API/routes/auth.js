"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _authModel=require("../model/authModel.js"),_authModel2=_interopRequireDefault(_authModel),express=require("express"),router=express.Router(),mysql=require("mysql"),RateLimit=require("express-rate-limit"),createAccountLimiter=new RateLimit({windowMs:3e5,delayAfter:3,delayMs:3e3,max:5,message:"Too many attempts from this IP, please try again in five minutes",handler:function(e,r){r.json({error:"Too many attempts from this IP, please try again in five minutes"})}});router.post("/login",createAccountLimiter,function(e,r,t){var o="select * from `_users` where `email` = ?",s=new _authModel2.default(o,e.body,r);s.login()}),router.post("/register",createAccountLimiter,function(e,r,t){var o="select * from `_users` where `email` = ?",s=new _authModel2.default(o,e.body,r);s.register()}),router.post("/confirmUser",createAccountLimiter,function(e,r,t){var o="update _users set `verified` = 1, `token` = NULL where `token` = ?",s=new _authModel2.default(o,e.body,r);s.confirmUser().then(function(e){console.log("result.success from promise",e.success),e&&r.status(200).json({success:!0})}).catch(function(e){console.log("error",e.error),"not-exist"===e.error?(console.log("NOT EXIST"),r.status(404).json({error:e.error})):r.status(500).json({error:e.error})})}),router.post("/changePassword",function(e,r,t){}),module.exports=router;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJvdXRlcy9hdXRoLmpzIl0sIm5hbWVzIjpbIl9hdXRoTW9kZWwiLCJyZXF1aXJlIiwiZXhwcmVzcyIsInJvdXRlciIsIlJvdXRlciIsIm15c3FsIiwiY3JlYXRlQWNjb3VudExpbWl0ZXIiLCJSYXRlTGltaXQiLCJ3aW5kb3dNcyIsImRlbGF5QWZ0ZXIiLCJkZWxheU1zIiwicmVxIiwicmVzIiwibWF4IiwianNvbiIsImVycm9yIiwicG9zdCIsIm5leHQiLCJlbWFpbENoZWNrU1FMIiwiTW9kZWwiLCJfYXV0aE1vZGVsMiIsImRlZmF1bHQiLCJib2R5IiwibG9naW4iLCJyZWdpc3RlciIsInVwZGF0ZUNvbmZpcm1Vc2VyU1FMIiwidGhlbiIsImNvbnNvbGUiLCJyZXN1bHQiLCJzdWNjZXNzIiwiY29uZmlybVVzZXIiLCJjYXRjaCIsImVyciIsImxvZyIsInN0YXR1cyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJxRkFLQSxHQUFBQSxZQUFBQyxRQUFBLHdFQUxJQyxRQUFVRCxRQUFRLFdBQ2xCRSxPQUFTRCxRQUFRRSxTQUlyQkMsTUFBQUosUUFBQSxTQUpJRSxVQUFTRCxRQUFRRSxzQkFVakJFLHFCQUF1QixHQUFJQyxZQUYvQkMsU0FBSUQsSUFJRkUsV0FBWSxFQUZkQyxRQUFJSixJQUNGRSxJQUFBQSxFQUNBQyxRQUFBQSxtRUFDQUMsUUFBUyxTQUFBQyxFQUFFQyxHQUNYQyxFQUp1Q0MsTUFJL0JDLE1BQUEsdUVBV1ZaLFFBQUFhLEtBQUEsU0FBQVYscUJBQUEsU0FBQUssRUFBQUMsRUFBQUssR0FDQSxHQUFBQyxHQUFBLDJDQUlNQyxFQUFRLEdBQUFDLGFBQUFDLFFBQWNILEVBQWVQLEVBQUlXLEtBQU1WLEVBRnJEVCxHQUFPYSxVQUdMRyxPQUFBQSxLQUFNSSxZQUFOakIscUJBQUEsU0FBQUssRUFBQUMsRUFBQUssR0FIRixHQUFBQyxHQUFBLDJDQVFNQyxFQUFRLEdBQUFDLGFBQUFDLFFBQWNILEVBQWVQLEVBQUlXLEtBQU1WLEVBRnJEVCxHQUFPYSxhQUdMRyxPQUFBQSxLQUFNSyxlQUFObEIscUJBQUEsU0FBQUssRUFBQUMsRUFBQUssR0FIRixHQUFBUSxHQUFBLHFFQVFNTixFQUFRLEdBQUFDLGFBQUFDLFFBQWNJLEVBQXNCZCxFQUFJVyxLQUFNVixFQUY1RFQsR0FBT2EsY0FBS1UsS0FBZ0JwQixTQUFBQSxHQUMxQnFCLFFBQUlGLElBQUFBLDhCQUF1QkcsRUFBQUMsU0FDdkJWLEdBQ0pBLEVBQU1XLE9BQUFBLEtBQWNKLE1BQ2xCQyxTQUFZLE1BR1JJLE1BQUEsU0FBQUMsR0FEbUJMLFFBQXJCTSxJQUFBLFFBQUFELEVBQUFqQixPQUdELGNBQUFpQixFQUFBakIsT0FDQ2dCLFFBQU9FLElBQUEsYUFDVE4sRUFBQUEsT0FBWSxLQUFBYixNQUNSa0IsTUFBQUEsRUFBQWpCLFNBR0FILEVBQUFzQixPQUFTRixLQUFJakIsTUFEZkEsTUFBQWlCLEVBQUFqQixZQVFIWixPQW5CRGEsS0FBQSxrQkFBQSxTQUFBTCxFQUFBQyxFQUFBSyxNQTRCRmtCLE9BQU9DLFFBQVVqQyIsImZpbGUiOiJyb3V0ZXMvYXV0aC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xudmFyIHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG52YXIgbXlzcWwgPSByZXF1aXJlKCdteXNxbCcpO1xuXG5cbmltcG9ydCBBdXRoTW9kZWwgZnJvbSAnLi4vbW9kZWwvYXV0aE1vZGVsLmpzJztcblxuXG5cbnZhciBSYXRlTGltaXQgPSByZXF1aXJlKCdleHByZXNzLXJhdGUtbGltaXQnKTtcblxudmFyIGNyZWF0ZUFjY291bnRMaW1pdGVyID0gbmV3IFJhdGVMaW1pdCh7XG4gIHdpbmRvd01zOiA1KjYwKjEwMDAsIC8vIDUgbWludXRlIHdpbmRvd1xuICBkZWxheUFmdGVyOiAzLCAvLyBiZWdpbiBzbG93aW5nIGRvd24gcmVzcG9uc2VzIGFmdGVyIHRoZSBmaXJzdCByZXF1ZXN0XG4gIGRlbGF5TXM6IDMqMTAwMCwgLy8gc2xvdyBkb3duIHN1YnNlcXVlbnQgcmVzcG9uc2VzIGJ5IDMgc2Vjb25kcyBwZXIgcmVxdWVzdFxuICBtYXg6IDUsIC8vIHN0YXJ0IGJsb2NraW5nIGFmdGVyIDUgcmVxdWVzdHNcbiAgbWVzc2FnZTogXCJUb28gbWFueSBhdHRlbXB0cyBmcm9tIHRoaXMgSVAsIHBsZWFzZSB0cnkgYWdhaW4gaW4gZml2ZSBtaW51dGVzXCIsXG4gIGhhbmRsZXI6IChyZXEscmVzKSA9PiB7XG4gICAgcmVzLmpzb24oeyAnZXJyb3InOiAnVG9vIG1hbnkgYXR0ZW1wdHMgZnJvbSB0aGlzIElQLCBwbGVhc2UgdHJ5IGFnYWluIGluIGZpdmUgbWludXRlcycgfSk7XG4gIH1cbn0pO1xuXG4vL1RPRE86XG5cbi8vc2VuZCBlbWFpbCBvdXQgb24gcmVnaXN0cmF0aW9uIC0gc3BhbSBjb250cm9sIC0gQ0hBTkdFIFNFTkQgR1JJRCAqKioqKioqKioqKioqKioqKioqKioqKioqXG5cbi8vZm9yZ290IHBhc3N3b3JkXG4vL2NoYW5nZSBwYXNzd29yZCAodHJ5IGFuZCBtYWtlIHRoaXMgd29yayBmb3IgYm90aCAoaWUgYWJvdmUgYXMgd2VsbCkpXG5cbnJvdXRlci5wb3N0KCcvbG9naW4nLCBjcmVhdGVBY2NvdW50TGltaXRlciwgKHJlcSxyZXMsbmV4dCkgPT4ge1xuICB2YXIgZW1haWxDaGVja1NRTCA9ICdzZWxlY3QgKiBmcm9tIGBfdXNlcnNgIHdoZXJlIGBlbWFpbGAgPSA/JztcbiAgdmFyIE1vZGVsID0gbmV3IEF1dGhNb2RlbChlbWFpbENoZWNrU1FMLCByZXEuYm9keSwgcmVzKTtcbiAgTW9kZWwubG9naW4oKTtcbn0pO1xuXG5yb3V0ZXIucG9zdCgnL3JlZ2lzdGVyJywgY3JlYXRlQWNjb3VudExpbWl0ZXIsIChyZXEscmVzLG5leHQpID0+IHtcbiAgdmFyIGVtYWlsQ2hlY2tTUUwgPSAnc2VsZWN0ICogZnJvbSBgX3VzZXJzYCB3aGVyZSBgZW1haWxgID0gPyc7XG4gIHZhciBNb2RlbCA9IG5ldyBBdXRoTW9kZWwoZW1haWxDaGVja1NRTCwgcmVxLmJvZHksIHJlcyk7XG4gIE1vZGVsLnJlZ2lzdGVyKCk7XG59KTtcblxucm91dGVyLnBvc3QoJy9jb25maXJtVXNlcicsIGNyZWF0ZUFjY291bnRMaW1pdGVyLCAocmVxLHJlcyxuZXh0KSA9PiB7XG4gIGxldCB1cGRhdGVDb25maXJtVXNlclNRTCA9ICd1cGRhdGUgX3VzZXJzIHNldCBgdmVyaWZpZWRgID0gMSwgYHRva2VuYCA9IE5VTEwgd2hlcmUgYHRva2VuYCA9ID8nIDtcbiAgdmFyIE1vZGVsID0gbmV3IEF1dGhNb2RlbCh1cGRhdGVDb25maXJtVXNlclNRTCwgcmVxLmJvZHksIHJlcyk7XG4gIE1vZGVsLmNvbmZpcm1Vc2VyKCkudGhlbiggKHJlc3VsdCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKCdyZXN1bHQuc3VjY2VzcyBmcm9tIHByb21pc2UnLHJlc3VsdC5zdWNjZXNzKTtcbiAgICBpZiAocmVzdWx0KSB7XG4gICAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7XG4gICAgICAgIFwic3VjY2Vzc1wiOiB0cnVlXG4gICAgICB9KTtcbiAgICB9XG4gIH0gKS5jYXRjaCggKGVycikgPT4ge1xuICAgIGNvbnNvbGUubG9nKCdlcnJvcicsZXJyLmVycm9yKTtcbiAgICBpZiAoZXJyLmVycm9yID09PSAnbm90LWV4aXN0Jykge1xuICAgICAgY29uc29sZS5sb2coJ05PVCBFWElTVCcpO1xuICAgICAgcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICBcImVycm9yXCI6IGVyci5lcnJvclxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgXCJlcnJvclwiOiBlcnIuZXJyb3JcbiAgICAgIH0pO1xuICAgIH1cbiAgfSApXG59KTtcblxucm91dGVyLnBvc3QoJy9jaGFuZ2VQYXNzd29yZCcsIChyZXEscmVzLG5leHQpID0+IHtcblxufSk7XG5cblxuXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==

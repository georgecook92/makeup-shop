"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _authModel=require("../model/authModel.js"),_authModel2=_interopRequireDefault(_authModel),_rateLimit=require("../general/rateLimit"),express=require("express"),router=express.Router();router.get("/getUserFromToken",function(e,r,t){var o="select * from `_users` where `user_id` = ?",u=e.get("Authorization")||"",s=new _authModel2.default(u,e.body,r,t,o);s.getUserFromToken()}),router.post("/login",_rateLimit.createAccountLimiter,function(e,r,t){var o="select * from `_users` where `email` = ?",u=new _authModel2.default("",e.body,r,t,o);u.login()}),router.post("/register",function(e,r,t){var o="select * from `_users` where `email` = ?",u="INSERT INTO _users SET ?",s=new _authModel2.default("",e.body,r,t,o,u);s.register()}),router.put("/confirmUser",function(e,r,t){var o="update _users set `verified` = 1, `token` = NULL where `token` = ?",u=new _authModel2.default("",e.body,r,t,o);u.confirmUser()}),router.put("/changePassword",function(e,r,t){if(e.body.user_id){var o="update _users set `password` = ? where `user_id` = ?",u=new _authModel2.default("",e.body,r,t,o);u.changePassword(e.body.user_id)}else if(e.body.token){var s="update _users set `password` = ? where `token` = ?",a="update _users set `token` = NULL where `token` = ?",d=new _authModel2.default("",e.body,r,t,s,a);d.changePassword(e.body.token)}}),router.put("/forgotPassword",function(e,r,t){var o="update _users set `token` = ? where `email` = ?",u=new _authModel2.default("",e.body,r,t,o);u.forgotPasswordSetup()}),module.exports=router;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJvdXRlcy9hdXRoLmpzIl0sIm5hbWVzIjpbIl9hdXRoTW9kZWwiLCJyZXF1aXJlIiwiX3JhdGVMaW1pdCIsImV4cHJlc3MiLCJyb3V0ZXIiLCJSb3V0ZXIiLCJnZXQiLCJyZXEiLCJyZXMiLCJuZXh0IiwiZW1haWxDaGVja1NRTCIsInRva2VuIiwiTW9kZWwiLCJfYXV0aE1vZGVsMiIsImRlZmF1bHQiLCJib2R5IiwicG9zdCIsImNyZWF0ZUFjY291bnRMaW1pdGVyIiwibG9naW4iLCJpbnNlcnRTUUwiLCJ1cGRhdGVDb25maXJtVXNlclNRTCIsImNvbmZpcm1Vc2VyIiwicHV0IiwidXNlcl9pZCIsImNoYW5nZVBhc3N3b3JkU1FMIiwiZm9yZ290UGFzc3dvcmRTUUwiLCJyZW1vdmVUb2tlblNRTCIsIkZvcmdvdE1vZGVsIiwiZm9yZ290dGVuUGFzc3dvcmRTUUwiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoicUZBRUEsR0FBQUEsWUFBQUMsUUFBQSx3RUFFQUMsV0FBQUQsUUFBQSx3QkFKSUUsUUFBVUYsUUFBUSxXQUNsQkcsT0FBU0QsUUFBUUUsUUFHckJELFFBQUFFLElBQUEsb0JBQUEsU0FBQUMsRUFBQUMsRUFBQUMsR0FHRSxHQUFJQyxHQUFnQiw2Q0FDZEMsRUFBUUosRUFBSUQsSUFBSSxrQkFBb0IsR0FDdENNLEVBQVEsR0FBQUMsYUFBQUMsUUFBY0gsRUFBT0osRUFBSVEsS0FBTVAsRUFBS0MsRUFBTUMsRUFUeERFLEdBQUlULHFCQWFKQyxPQUFPWSxLQUFLLFNBQVpkLFdBQUFlLHFCQUE0QyxTQUFDVixFQUFLQyxFQUFLQyxHQVB2REwsR0FBQUEsR0FBVywyQ0FFSE8sRUFBUUosR0FBQUEsYUFBQUEsUUFBUSxHQUFBQSxFQUFBUSxLQUFvQlAsRUFBMUNDLEVBQUFDLEVBQ0FFLEdBQUlBLFVBV05SLE9BQU9ZLEtBQUssWUFBYSxTQUFDVCxFQUFLQyxFQUFLQyxHQVBwQ0wsR0FBQUEsR0FBQSwyQ0FDTU0sRUFBQUEsMkJBRUFFLEVBQVEsR0FBQUMsYUFBQUMsUUFBQSxHQUFBUCxFQUFBUSxLQUFrQlIsRUFBSVEsRUFBTVAsRUFBV0UsRUFDbkRFLEdBQU1NLGFBR1JkLE9BQU9ZLElBQVAsZUFBeUIsU0FBQVQsRUFBQUMsRUFBQUMsR0FDdkIsR0FBSUMsR0FBZ0IscUVBQ2hCUyxFQUFBQSxHQUFBQSxhQUFBQSxRQUFZLEdBQUFaLEVBQUFRLEtBQUFQLEVBQWhCQyxFQUFBVyxFQVNBUixHQUFNUyxnQkFMUGpCLE9BTkRrQixJQUFBLGtCQUFBLFNBQUFmLEVBQUFDLEVBQUFDLEdBZUUsR0FBSUYsRUFBSVEsS0FBS1EsUUFBUyxDQVB4Qm5CLEdBQU9rQixHQUFvQix1REFDckJGLEVBQUFBLEdBQUFBLGFBQUFBLFFBQXVCLEdBQUFiLEVBQUFRLEtBQUFQLEVBQUFDLEVBQUFlLEVBQzNCWixHQUFJQSxlQUFRTCxFQUFBUSxLQUFBUSxhQUNORixJQUFBQSxFQUFBQSxLQUFOVixNQUFBLENBSEYsR0FBQWMsR0FBQSxxREFhUUMsRUFBaUIscURBUGxCSixFQUFJLEdBQUFULGFBQUFDLFFBQW1CLEdBQUNQLEVBQURRLEtBQVdOLEVBQVhBLEVBQW9CZ0IsRUFBQUMsRUFDaERDLEdBQWFKLGVBQVNoQixFQUFBUSxLQUFBSixVQUlyQlAsT0FKRGtCLElBSU8sa0JBQW9CLFNBQUFmLEVBQUFDLEVBQUFDLEdBQ3pCLEdBQUFtQixHQUF3QixrREFDeEJoQixFQUFJYyxHQUFBQSxhQUFBQSxRQUFpQixHQUFBbkIsRUFBQVEsS0FBQVAsRUFBQUMsRUFBQW1CLEVBQ3JCaEIsR0FBSWUsd0JBR1BFLE9BWERDLFFBQUExQiIsImZpbGUiOiJyb3V0ZXMvYXV0aC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xudmFyIHJvdXRlciA9IGV4cHJlc3MuUm91dGVyKCk7XG5pbXBvcnQgQXV0aE1vZGVsIGZyb20gJy4uL21vZGVsL2F1dGhNb2RlbC5qcyc7XG5cbmltcG9ydCB7Y3JlYXRlQWNjb3VudExpbWl0ZXJ9IGZyb20gJy4uL2dlbmVyYWwvcmF0ZUxpbWl0Jztcblxucm91dGVyLmdldCgnL2dldFVzZXJGcm9tVG9rZW4nLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgdmFyIGVtYWlsQ2hlY2tTUUwgPSAnc2VsZWN0ICogZnJvbSBgX3VzZXJzYCB3aGVyZSBgdXNlcl9pZGAgPSA/JztcbiAgY29uc3QgdG9rZW4gPSByZXEuZ2V0KCdBdXRob3JpemF0aW9uJykgfHwgXCJcIjtcbiAgdmFyIE1vZGVsID0gbmV3IEF1dGhNb2RlbCh0b2tlbiwgcmVxLmJvZHksIHJlcywgbmV4dCwgZW1haWxDaGVja1NRTCk7XG4gIE1vZGVsLmdldFVzZXJGcm9tVG9rZW4oKTtcbn0pO1xuXG5yb3V0ZXIucG9zdCgnL2xvZ2luJywgY3JlYXRlQWNjb3VudExpbWl0ZXIsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICB2YXIgZW1haWxDaGVja1NRTCA9ICdzZWxlY3QgKiBmcm9tIGBfdXNlcnNgIHdoZXJlIGBlbWFpbGAgPSA/JztcbiAgLy8gZW1wdHkgdG9rZW5cbiAgdmFyIE1vZGVsID0gbmV3IEF1dGhNb2RlbCgnJywgcmVxLmJvZHksIHJlcywgbmV4dCwgZW1haWxDaGVja1NRTCk7XG4gIE1vZGVsLmxvZ2luKCk7XG59KTtcblxucm91dGVyLnBvc3QoJy9yZWdpc3RlcicsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICB2YXIgZW1haWxDaGVja1NRTCA9ICdzZWxlY3QgKiBmcm9tIGBfdXNlcnNgIHdoZXJlIGBlbWFpbGAgPSA/JztcbiAgdmFyIGluc2VydFNRTCA9ICdJTlNFUlQgSU5UTyBfdXNlcnMgU0VUID8nO1xuXG4gIHZhciBNb2RlbCA9IG5ldyBBdXRoTW9kZWwoJycsIHJlcS5ib2R5LCByZXMsIG5leHQsIGVtYWlsQ2hlY2tTUUwsIGluc2VydFNRTCk7XG4gIE1vZGVsLnJlZ2lzdGVyKCk7XG59KTtcblxucm91dGVyLnB1dCgnL2NvbmZpcm1Vc2VyJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIHZhciB1cGRhdGVDb25maXJtVXNlclNRTCA9ICd1cGRhdGUgX3VzZXJzIHNldCBgdmVyaWZpZWRgID0gMSwgYHRva2VuYCA9IE5VTEwgd2hlcmUgYHRva2VuYCA9ID8nO1xuICB2YXIgTW9kZWwgPSBuZXcgQXV0aE1vZGVsKCcnLCByZXEuYm9keSwgcmVzLCBuZXh0LCB1cGRhdGVDb25maXJtVXNlclNRTCk7XG4gIE1vZGVsLmNvbmZpcm1Vc2VyKCk7XG59KTtcblxucm91dGVyLnB1dCgnL2NoYW5nZVBhc3N3b3JkJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIGlmIChyZXEuYm9keS51c2VyX2lkKSB7XG4gICAgdmFyIGNoYW5nZVBhc3N3b3JkU1FMID0gJ3VwZGF0ZSBfdXNlcnMgc2V0IGBwYXNzd29yZGAgPSA/IHdoZXJlIGB1c2VyX2lkYCA9ID8nO1xuICAgIHZhciBNb2RlbCA9IG5ldyBBdXRoTW9kZWwoJycsIHJlcS5ib2R5LCByZXMsIG5leHQsIGNoYW5nZVBhc3N3b3JkU1FMKTtcbiAgICBNb2RlbC5jaGFuZ2VQYXNzd29yZChyZXEuYm9keS51c2VyX2lkKTtcbiAgfSBlbHNlIGlmIChyZXEuYm9keS50b2tlbikge1xuICAgIHZhciBmb3Jnb3RQYXNzd29yZFNRTCA9ICd1cGRhdGUgX3VzZXJzIHNldCBgcGFzc3dvcmRgID0gPyB3aGVyZSBgdG9rZW5gID0gPyc7XG4gICAgdmFyIHJlbW92ZVRva2VuU1FMID0gJ3VwZGF0ZSBfdXNlcnMgc2V0IGB0b2tlbmAgPSBOVUxMIHdoZXJlIGB0b2tlbmAgPSA/JztcbiAgICB2YXIgRm9yZ290TW9kZWwgPSBuZXcgQXV0aE1vZGVsKCcnLCByZXEuYm9keSwgcmVzLCBuZXh0LCBmb3Jnb3RQYXNzd29yZFNRTCwgcmVtb3ZlVG9rZW5TUUwpO1xuICAgIEZvcmdvdE1vZGVsLmNoYW5nZVBhc3N3b3JkKHJlcS5ib2R5LnRva2VuKTtcbiAgfVxufSk7XG5cbnJvdXRlci5wdXQoJy9mb3Jnb3RQYXNzd29yZCcsIChyZXEsIHJlcywgbmV4dCkgPT4ge1xuICB2YXIgZm9yZ290dGVuUGFzc3dvcmRTUUwgPSAndXBkYXRlIF91c2VycyBzZXQgYHRva2VuYCA9ID8gd2hlcmUgYGVtYWlsYCA9ID8nO1xuICB2YXIgTW9kZWwgPSBuZXcgQXV0aE1vZGVsKCcnLCByZXEuYm9keSwgcmVzLCBuZXh0LCBmb3Jnb3R0ZW5QYXNzd29yZFNRTCk7XG4gIE1vZGVsLmZvcmdvdFBhc3N3b3JkU2V0dXAoKTtcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjtcbiJdfQ==

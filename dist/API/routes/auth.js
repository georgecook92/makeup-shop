"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _authModel=require("../model/authModel.js"),_authModel2=_interopRequireDefault(_authModel),express=require("express"),router=express.Router(),RateLimit=require("express-rate-limit"),createAccountLimiter=new RateLimit({windowMs:3e5,delayAfter:3,delayMs:3e3,max:5,message:"Too many attempts from this IP, please try again in five minutes",handler:function(e,t){t.json({error:"Too many attempts from this IP, please try again in five minutes"})}});router.post("/login",createAccountLimiter,function(e,t,r){var o="select * from `_users` where `email` = ?",s=new _authModel2.default(o,e.body,t,r);s.login()}),router.post("/register",createAccountLimiter,function(e,t,r){var o="select * from `_users` where `email` = ?",s=new _authModel2.default(o,e.body,t,r);s.register()}),router.post("/confirmUser",createAccountLimiter,function(e,t,r){var o="update _users set `verified` = 1, `token` = NULL where `token` = ?",s=new _authModel2.default(o,e.body,t,r);s.confirmUser()}),router.post("/changePassword",function(e,t,r){var o="update _users set `password` = ? where `user_id` = ?",s=new _authModel2.default(o,e.body,t,r);s.changePassword()}),module.exports=router;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJvdXRlcy9hdXRoLmpzIl0sIm5hbWVzIjpbIl9hdXRoTW9kZWwiLCJyZXF1aXJlIiwiZXhwcmVzcyIsInJvdXRlciIsIlJvdXRlciIsIlJhdGVMaW1pdCIsImNyZWF0ZUFjY291bnRMaW1pdGVyIiwid2luZG93TXMiLCJkZWxheUFmdGVyIiwiZGVsYXlNcyIsIm1heCIsIm1lc3NhZ2UiLCJoYW5kbGVyIiwicmVzIiwianNvbiIsImVycm9yIiwicG9zdCIsInJlcSIsIm5leHQiLCJlbWFpbENoZWNrU1FMIiwiTW9kZWwiLCJfYXV0aE1vZGVsMiIsImRlZmF1bHQiLCJib2R5IiwibG9naW4iLCJ1cGRhdGVDb25maXJtVXNlclNRTCIsImNoYW5nZVBhc3N3b3JkU1FMIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6InFGQUVBLEdBQUFBLFlBQUFDLFFBQUEsd0VBRklDLFFBQVVELFFBQVEsV0FDbEJFLE9BQVNELFFBQVFFLFNBR2pCQyxVQUFZSixRQUFRLHNCQUVwQksscUJBQXVCLEdBQUlELFlBQzdCRSxTQUFVLElBUFpDLFdBQWNQLEVBQ2RRLFFBQUlOLElBU0ZPLElBQUssRUFDTEMsUUFBUyxtRUFQWEMsUUFBSVAsU0FBQUEsRUFBWUosR0FTWlksRUFBSUMsTUFBTUMsTUFBTyx1RUFDbEJaLFFBQUFhLEtBQUEsU0FBQVYscUJBQUEsU0FBQVcsRUFBQUosRUFBQUssR0FSSCxHQUFBQyxHQUFBLDJDQWtCTUMsRUFBUSxHQUFBQyxhQUFBQyxRQUFjSCxFQUFlRixFQUFJTSxLQUFNVixFQUFLSyxFQVAxREUsR0FBQUksVUFHQXJCLE9BQUFhLEtBQUEsWUFBQVYscUJBQUEsU0FBQVcsRUFBQUosRUFBQUssR0FTRSxHQUFJQyxHQUFnQiwyQ0FQdEJoQixFQUFZLEdBQUFrQixhQUFBQyxRQUFVaEIsRUFBdEJXLEVBQTRDTSxLQUFBVixFQUFBSyxFQUMxQ0UsR0FBSUQsYUFHTGhCLE9BSkRhLEtBQUEsZUFBQVYscUJBQUEsU0FBQVcsRUFBQUosRUFBQUssR0FhRSxHQUFJTyxHQUF1QixxRUFQN0J0QixFQUFZLEdBQUFrQixhQUFBQyxRQUFhaEIsRUFBc0JXLEVBQUFNLEtBQUFWLEVBQUFLLEVBQzdDRSxHQUFJRCxnQkFHTGhCLE9BSkRhLEtBQUEsa0JBQUEsU0FBQUMsRUFBQUosRUFBQUssR0FhRSxHQUFJUSxHQUFvQix1REFQMUJ2QixFQUFZLEdBQUFrQixhQUFBQyxRQUFnQmhCLEVBQUFBLEVBQXNCaUIsS0FBQVYsRUFBQ0ksRUFDakRHLEdBQUlLLG1CQUdMRSxPQUpEQyxRQUFBekIiLCJmaWxlIjoicm91dGVzL2F1dGguanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbnZhciByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuaW1wb3J0IEF1dGhNb2RlbCBmcm9tICcuLi9tb2RlbC9hdXRoTW9kZWwuanMnO1xuXG52YXIgUmF0ZUxpbWl0ID0gcmVxdWlyZSgnZXhwcmVzcy1yYXRlLWxpbWl0Jyk7XG5cbnZhciBjcmVhdGVBY2NvdW50TGltaXRlciA9IG5ldyBSYXRlTGltaXQoe1xuICB3aW5kb3dNczogNSAqIDYwICogMTAwMCwgLy8gNSBtaW51dGUgd2luZG93XG4gIGRlbGF5QWZ0ZXI6IDMsIC8vIGJlZ2luIHNsb3dpbmcgZG93biByZXNwb25zZXMgYWZ0ZXIgdGhlIGZpcnN0IHJlcXVlc3RcbiAgZGVsYXlNczogMyAqIDEwMDAsIC8vIHNsb3cgZG93biBzdWJzZXF1ZW50IHJlc3BvbnNlcyBieSAzIHNlY29uZHMgcGVyIHJlcXVlc3RcbiAgbWF4OiA1LCAvLyBzdGFydCBibG9ja2luZyBhZnRlciA1IHJlcXVlc3RzXG4gIG1lc3NhZ2U6IFwiVG9vIG1hbnkgYXR0ZW1wdHMgZnJvbSB0aGlzIElQLCBwbGVhc2UgdHJ5IGFnYWluIGluIGZpdmUgbWludXRlc1wiLFxuICBoYW5kbGVyOiAocmVxLCByZXMpID0+IHtcbiAgICByZXMuanNvbih7ZXJyb3I6ICdUb28gbWFueSBhdHRlbXB0cyBmcm9tIHRoaXMgSVAsIHBsZWFzZSB0cnkgYWdhaW4gaW4gZml2ZSBtaW51dGVzJ30pO1xuICB9XG59KTtcblxuLy8gc2VuZCBlbWFpbCBvdXQgb24gcmVnaXN0cmF0aW9uIC0gc3BhbSBjb250cm9sIC0gQ0hBTkdFIFNFTkQgR1JJRCAqKioqKioqKioqKioqKioqKioqKioqKioqXG5cbi8vIGZvcmdvdCBwYXNzd29yZFxuLy8gY2hhbmdlIHBhc3N3b3JkICh0cnkgYW5kIG1ha2UgdGhpcyB3b3JrIGZvciBib3RoIChpZSBhYm92ZSBhcyB3ZWxsKSlcblxucm91dGVyLnBvc3QoJy9sb2dpbicsIGNyZWF0ZUFjY291bnRMaW1pdGVyLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgdmFyIGVtYWlsQ2hlY2tTUUwgPSAnc2VsZWN0ICogZnJvbSBgX3VzZXJzYCB3aGVyZSBgZW1haWxgID0gPyc7XG4gIHZhciBNb2RlbCA9IG5ldyBBdXRoTW9kZWwoZW1haWxDaGVja1NRTCwgcmVxLmJvZHksIHJlcywgbmV4dCk7XG4gIE1vZGVsLmxvZ2luKCk7XG59KTtcblxucm91dGVyLnBvc3QoJy9yZWdpc3RlcicsIGNyZWF0ZUFjY291bnRMaW1pdGVyLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgdmFyIGVtYWlsQ2hlY2tTUUwgPSAnc2VsZWN0ICogZnJvbSBgX3VzZXJzYCB3aGVyZSBgZW1haWxgID0gPyc7XG4gIHZhciBNb2RlbCA9IG5ldyBBdXRoTW9kZWwoZW1haWxDaGVja1NRTCwgcmVxLmJvZHksIHJlcywgbmV4dCk7XG4gIE1vZGVsLnJlZ2lzdGVyKCk7XG59KTtcblxucm91dGVyLnBvc3QoJy9jb25maXJtVXNlcicsIGNyZWF0ZUFjY291bnRMaW1pdGVyLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgdmFyIHVwZGF0ZUNvbmZpcm1Vc2VyU1FMID0gJ3VwZGF0ZSBfdXNlcnMgc2V0IGB2ZXJpZmllZGAgPSAxLCBgdG9rZW5gID0gTlVMTCB3aGVyZSBgdG9rZW5gID0gPyc7XG4gIHZhciBNb2RlbCA9IG5ldyBBdXRoTW9kZWwodXBkYXRlQ29uZmlybVVzZXJTUUwsIHJlcS5ib2R5LCByZXMsIG5leHQpO1xuICBNb2RlbC5jb25maXJtVXNlcigpO1xufSk7XG5cbnJvdXRlci5wb3N0KCcvY2hhbmdlUGFzc3dvcmQnLCAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgdmFyIGNoYW5nZVBhc3N3b3JkU1FMID0gJ3VwZGF0ZSBfdXNlcnMgc2V0IGBwYXNzd29yZGAgPSA/IHdoZXJlIGB1c2VyX2lkYCA9ID8nO1xuICB2YXIgTW9kZWwgPSBuZXcgQXV0aE1vZGVsKGNoYW5nZVBhc3N3b3JkU1FMLCByZXEuYm9keSwgcmVzLCBuZXh0KTtcbiAgTW9kZWwuY2hhbmdlUGFzc3dvcmQoKTtcbn0pO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHJvdXRlcjtcbiJdfQ==
